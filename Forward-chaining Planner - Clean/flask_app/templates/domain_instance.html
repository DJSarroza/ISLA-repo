{% extends "layout_default.html" %}

{% block content %}
<script>
document.getElementById("main-nav-link-domains").className += " active";
document.getElementById("main-nav-link-ncs").className += " active";
</script>

<script>
object_types_array = new Array()
{% for someobj in object_types%}
  object_types_array.push(["{{ someobj.object_type }}","{{ someobj.parent_type }}"])
{% endfor %}

new_domain = {{ load_type }}

if(new_domain == 0){
    add_flash_message("Existing domain loaded for editting","success","default","header_flash_message_area","top");
}else
if(new_domain == 1){
    add_flash_message("New domain created","success","default","header_flash_message_area","top");
}



</script>

<script>

    // GLOBAL VARIABLES
    
    _MAX_STATEPREDICATE_PARAMETERS = 4
    _MAX_ACTION_PARAMETERS = 6
    
    _MAX_STATEPREDICATE_HUMANREADABLES = 4
    _MAX_ACTION_HUMANREADABLES = 4
    
    

    function typeIsOfType(type1, type2){
        //alert(type1 + " == " + type2)
        if(type1 == type2){
            return(true)
        }
        
        for(var i=0;i<object_types_array.length;i++){
            if(object_types_array[i][0] == type1){
                return(typeIsOfType(object_types_array[i][1],type2))
            }
        }
        
        return(false)
        
    }
    
    function generate_domain_file(){
        domain_id = "{{ domain_instance.id }}"
        document.getElementById("img_finalize_loader").style.visibility = "visible";
        document.getElementById("generate_domain_file_button").disabled = true
        
        $.getJSON($SCRIPT_ROOT + '/_generate_domain_file', {
            domain_id   : domain_id
        }, function(data) {
            //document.body.scrollTop = 0; // For Safari
            //document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            
            document.getElementById("img_finalize_loader").style.visibility = "hidden";
            document.getElementById("generate_domain_file_button").disabled = false
            split_str = data.result.split("/;")
            add_flash_message(split_str[0],split_str[1],"default","header_flash_message_area","top")
        });
    }
    
    function check_domain(){
        
        // General Domain Info
        
        // Object Types
        
        // State Predicates
        
        // Actions
        
    }
    

</script>


<!----------- [ BREADCRUMBS AREA ] -->
<div class="content-section">
    <div id="top-breadcrumbs">
    </div>
</div>

<script>
var tree_structure = {
    chart: {
        container: "#top-breadcrumbs",
        levelSeparation:    160,
        siblingSeparation:  70,
        subTeeSeparation:   170,
        nodeAlign: "BOTTOM",
        rootOrientation: "WEST",
        scrollbar: "fancy",
        padding: 15,
        node: { HTMLclass: "evolution-tree" },
        connectors: {
            type: "curve",
            style: {
                "stroke-width": 2,
                "stroke-linecap": "round",
                "stroke": "#ccc"
            }
        }
    },
    
    nodeStructure: {
        text: { 
            desc: "Domain"
        },
        //HTMLclass: "font-weight-bold",
        image: "{{ url_for('static',filename='assets/dot.png') }}",
        children: [
            {
                text: {
                    desc: "Sequence Terms" 
                },
                //HTMLclass: "the-parent",
                image: "{{ url_for('static',filename='assets/circle.png') }}",
                children: [
                    {
                        text: { 
                            desc: "Chapter Patterns" 
                        },
                        //HTMLclass: "the-parent",
                        image: "{{ url_for('static',filename='assets/circle.png') }}",
                        children: [
                            {
                                text: { 
                                    desc: "Locations" 
                                },
                                //HTMLclass: "the-parent",
                                image: "{{ url_for('static',filename='assets/circle.png') }}",
                                children: [
                                    {
                                        text: { 
                                            desc: "Object Names" 
                                        },
                                        //HTMLclass: "the-parent",
                                        image: "{{ url_for('static',filename='assets/circle.png') }}",
                                    }
                                ]
                            }
                        ]
                    }
                ]
            
            }
        ]
    }

};

new Treant( tree_structure );

</script>


<!----------- [ TOP MENU BAR ] -->
<div class="content-section">
    <div class="btn-group">
        <a href="{{ url_for('create_domain', copy_from='') }}" class="btn btn-info btn-sm">New</a>
        <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#topmenu_loadmodal">Load</button>
    </div>
</div>

<!-- Load Modal Space-->
<div class="modal fade" id="topmenu_loadmodal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          
          <h4 class="modal-title">Load Domain</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body small">
        
            <p class="small text-info font-italic"><!--Some text in the modal. --></p>

            <div class="row form-group">
                <div class="col-md-3">
                Domain ID
                </div>
                <div class="col-md-3">
                Created By
                </div>
                <div class="col-md-3">
                Last Edited By
                </div>
            </div>
            {% for some_loadable_domain in loadable_domains %}
            
            <div class="row form-group">
                <div class="col-md-3">
                {{ some_loadable_domain.id }}
                </div>
                <div class="col-md-3">
                {{ some_loadable_domain.created_by }}
                </div>
                <div class="col-md-3">
                {{ some_loadable_domain.last_edited_by }}
                </div>
                <div class="col-md-3">
                <a href="{{ url_for('domain_instance',domain_instance_id=some_loadable_domain.id) }}">Load</a>
                </div>
            </div>
            
            {%  endfor %}

        </div>
      </div>
      
    </div>
</div>


<!----------- [ DOMAIN GENERAL INFORMATION ] -->
<script>
</script>
<div class="content-section" id="domain_section">
    <div class="row form-group">
        <div class="col-md-8">
            <h3 class="display-5">General Information</h3>
            <div class="small text-info font-italic">
            <!--*Tooltip area thingie -->
            </div>
        </div>
        <div class="col-md-2">
            <!-- Trigger the modal with a button -->
            {% if (user_id == domain_instance.created_by) or ("WRITE" in domain_instance.visibility) %}
            <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#geninfo_editmodal">Edit General Information</button>
            {% else %}
            <button type="button" class="btn btn-sm" disabled>Edit General Information</button>
            {% endif %}
        </div>
            
        <!-- Edit Space-->
        <div class="modal fade" id="geninfo_editmodal" role="dialog">
            <div class="modal-dialog" style="max-width: 700px;">
            
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  
                  <h4 class="modal-title">Domain General Information</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                
                    <p class="small text-info font-italic">Domain identifiers</p>
                    
                    <div class="row pt-1">
                        <div class="col-md-4">
                        Domain ID
                        </div>
                        <div class="col-md-8">
                            <input class='form-control'  id="geninfo_id" type="text" size="16" disabled value="{{ domain_instance.id }}">
                        </div>
                    </div>
                    

                    
                    <div class="row pt-1">
                        <div class="col-md-4">
                        Category
                        </div>
                        
                        <div class="col-md-8">
                            <input class="form-control" type="text" id="geninfo_category" value="{{ domain_instance.category }}">
                            <input class="form-control" type="hidden" id="geninfo_category_str" value="{{ domain_instance.category_str }}" disabled>
                            
                        </div>
                        
                    </div>
                    <div class="row pt-1">
                        <div class="col-md-4">
                        Sub-category
                        </div>
                        
                        <div class="col-md-8">
                            <input class="form-control" type="text" id="geninfo_sub_label" value="{{ domain_instance.sub_label }}">
                            <input class="form-control" type="hidden" id="geninfo_sub_label_str" value="{{ domain_instance.sub_label_str }}" disabled>
                            
                        </div>
                        
                    </div>

                    <!--//=============================================================-->
                    <div class="dropdown-divider"></div>
                    
                    <p class="small text-info font-italic">Domain additional information</p>
                    
                    <div class="row pt-1">
                        <div class="col-md-4">
                        Domain Label
                            <div class="small text-info font-italic">
                            *Alphanumeric and underscore characters allowed; no spaces
                            </div>
                        </div>
                        <div class="col-md-8">
                            <input class='form-control'  id="geninfo_readable_label" type="text" size="16" value="{{ domain_instance.readable_label }}">
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-md-4">
                        Visibility
                            <div class="small text-info font-italic">
                            
                            </div>
                        </div>
                        <div class="col-md-8">
                            <select class='form-control'  id="geninfo_visibility">
                              <option value="PRIVATE-WRITE">Private</option>
                              <option value="PUBLIC-READONLY">Public - Read Only</option>
                              <option value="PUBLIC-WRITE">Public - Full Privileges</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-md-4">
                        Author's Notes
                            <div class="small text-info font-italic">
                            
                            </div>
                        </div>
                        <div class="col-md-8">
                            <textarea class='form-control'  id="geninfo_author_notes" rows="6" cols="32">{{ domain_instance.author_notes }}</textarea>
                        </div>
                        
                    </div>
                </div>
                <div class="modal-footer">
                  <button id="geninfo_add" type="button" class="btn btn-default border-info" data-dismiss="modal">Update</button>
                  <button id="geninfo_cancel" type="button" class="btn btn-default border-info" data-dismiss="modal">Cancel</button>
                  
                  <script>
                    $(function() {
                        $('button#geninfo_add').bind('click', function() {
                    
                            $.getJSON($SCRIPT_ROOT + '/_submit_domain_geninfo', {
                                
                                domain_id       : document.getElementById("geninfo_id").value              ,
                                category        : document.getElementById("geninfo_category").value        ,
                                sub_label       : document.getElementById("geninfo_sub_label").value       ,
                                readable_label  : document.getElementById("geninfo_readable_label").value  ,
                                visibility      : document.getElementById("geninfo_visibility").value      ,
                                author_notes    : document.getElementById("geninfo_author_notes").value    
                                
                            }, function(data) {
                                $('#geninfo_display_readable_label').html(document.getElementById("geninfo_readable_label").value);
                                $('#geninfo_display_visibility').html(document.getElementById("geninfo_visibility").value);
                                $('#geninfo_display_author_notes').html(document.getElementById("geninfo_author_notes").value);
                            });
                        });
                    });
                  </script>
                  
                </div>
              </div>
              
            </div>
        </div>
    
    

    </div>
    
    <div>
        
        <div class="row">
            <div class="col-sm-3">
            Domain Label
            </div>
            <div id="geninfo_display_readable_label" class="col-sm-8">
            {{ domain_instance.readable_label }}
            </div>
        </div>
        <div class="row">
            <div class="col-sm-3">
            Visibility
            </div>
            <div id="geninfo_display_visibility" class="col-sm-8">
            {{ domain_instance.visibility }}
            </div>
        </div>
        <div class="row">
            <div class="col-sm-3">
            Author's Notes
            </div>
            <div id="geninfo_display_author_notes" class="col-sm-8">
            {{ domain_instance.author_notes }}
            </div>
        </div>


    </div>
</div>
    
<!----------- [ OBJECT TYPES ] -->
<script type="text/javascript" id="objects_section">
    function objecttype_edit_onclick(input_id){
        document.getElementById('objecttype_prevobj_type').value = document.getElementById(input_id + "_prevobj_type").value
        document.getElementById('objecttype_object_type').value = document.getElementById(input_id + "_object_type").value
        document.getElementById('objecttype_parent_type').value = document.getElementById(input_id + "_parent_type").value
    }
    
    function objecttype_add_onclick(input_id){
        document.getElementById('objecttype_prevobj_type').value = ""
        document.getElementById('objecttype_object_type').value  = ""
        document.getElementById('objecttype_parent_type').value  = ""
    }
    
    function addObjectToDisplay(prevobj_type, object_type, parent_type){
        
        if(document.getElementById("objecttype_"+prevobj_type+"_main_row")){
            main_row = document.getElementById("objecttype_"+prevobj_type+"_main_row")
            main_row.parentNode.removeChild(main_row)
        }
        
        output_HTML = document.getElementById("current_objects_display_area").innerHTML
        output_HTML = output_HTML + "\n"
        
        output_HTML = output_HTML + "    <div id='objecttype_"+object_type+"_main_row' class='row pt-1'>\n"
        output_HTML = output_HTML + "        <div class='col-sm-8'>\n"
        output_HTML = output_HTML + "        ("+object_type+", "+parent_type+") \n"
        output_HTML = output_HTML + "        <input class='form-control'  type='hidden' disabled id='objecttype_"+object_type+"_prevobj_type' value='"+object_type+"'/>\n"
        output_HTML = output_HTML + "        <input class='form-control'  type='hidden' disabled id='objecttype_"+object_type+"_object_type' value='"+object_type+"'/>\n"
        output_HTML = output_HTML + "        <input class='form-control'  type='hidden' disabled id='objecttype_"+object_type+"_parent_type' value='"+parent_type+"'/>\n"
        output_HTML = output_HTML + "        </div>\n"
        output_HTML = output_HTML + "        <div class='col-sm-2'>\n"
        output_HTML = output_HTML + "        <button id='objecttype_"+object_type+"_edit'                                                   \n"
        output_HTML = output_HTML + "                type='button'                                                                          \n"
        output_HTML = output_HTML + "                class='btn btn-info btn-sm'                                                            \n"
        output_HTML = output_HTML + "                data-toggle='modal'                                                                    \n"
        output_HTML = output_HTML + "                data-target='#objecttype_editmodal'                                                    \n"
        output_HTML = output_HTML + "                onclick='objecttype_edit_onclick('objecttype_"+object_type+"')'>                       \n"
        output_HTML = output_HTML + "                Edit Type                                                                              \n"
        output_HTML = output_HTML + "        </button>\n"
        output_HTML = output_HTML + "        </div>\n"
        output_HTML = output_HTML + "    </div>\n"
            
        document.getElementById("current_objects_display_area").innerHTML = output_HTML
        
        $(".animated").addClass("delay-1s");
        generate_objecttype_treant_display()
    }
    
    function update_objecttype_parent_type_container(raw_result){
    
        raw_rows = raw_result.split("/|")
        
        output_HTML = ""
        output_HTML = output_HTML + "<select class='form-control'  id='objecttype_parent_type'>\n"
        output_HTML = output_HTML + "<option value='none'>None</option>\n"
        
        for(var i=0; i<raw_rows.length; i++){
            split_row = raw_rows[i].split("/;")
            
            if(split_row.length == 7){
                output_HTML = output_HTML + "<option value='"+split_row[2]+"'>"+split_row[2]+"</option>\n"
            }
        }
        
        output_HTML = output_HTML + "</select>\n"
        
        document.getElementById("objecttype_parent_type_container").innerHTML = output_HTML
    /*
                            <div id="objecttype_parent_type_container">
                                <select class='form-control'  id="objecttype_parent_type">
                                <option value="none">None</option>
                                {% for some_object_type in object_types %}
                                <option value="{{ some_object_type.object_type }}">{{ some_object_type.object_type }}</option>
                                {% endfor %}
                                </select>
                            </div>
    */
    }
    
    function objecttype_add(){
        
        if(valid_objecttype()){
            
            $.getJSON($SCRIPT_ROOT + '/_add_domain_objtype', {
                
                domain_id          :  document.getElementById("geninfo_id").value              ,
                prevobj_type       :  document.getElementById("objecttype_prevobj_type").value  ,
                object_type        :  document.getElementById("objecttype_object_type").value  ,
                parent_type        :  document.getElementById("objecttype_parent_type").value    
                
            }, function(data) {
            
            
                $.getJSON($SCRIPT_ROOT + '/_get_objecttypes', {
                    domain_id   :  document.getElementById("geninfo_id").value
                }, function(data) {
                    
                    update_objecttype_parent_type_container(data.result)
                    
                    prevobj_type = document.getElementById("objecttype_prevobj_type").value
                    object_type = document.getElementById("objecttype_object_type").value
                    parent_type = document.getElementById("objecttype_parent_type").value
                    addObjectToDisplay(prevobj_type, object_type, parent_type);
                    
                });
        

                
            });
        }else{
            //alert("Invalid object type")
            //add_flash_message("Invalid object type","danger","default","objecttype_input_flash_area","target")
            add_flash_message("Invalid object type","danger","default","header_flash_message_area","target")
        }
    }
    
    function valid_objecttype(){
        return_value = true
        if(document.getElementById("objecttype_object_type").value == ""){
            if(return_value){
                return_value = false
            }
        }
        
        return return_value
    }
    
    function update_objecttype_treant_display(raw_result){
        
        raw_rows = raw_result.split("/|")
        node_array = []
        
        root_node = {
            //text: { name: "Object Types" },
            HTMLclass: "the-parent",
            //pseudo: true,
            stackChildren: true,
            parentLabelString: ""
        }
        
        node_array.push(root_node)
        
        for(var i=0; i<raw_rows.length; i++){
            split_row = raw_rows[i].split("/;")
            
            if(split_row.length == 7){
                objecttype_id           = split_row[0]
                objecttype_domain_id    = split_row[1]
                objecttype_object_type  = split_row[2]
                objecttype_parent_type  = split_row[3]
                objecttype_default_flag = split_row[4]
                objecttype_status       = split_row[5]
                
                new_node = {
                    text: { 
                        name: objecttype_object_type 
                    },
                    HTMLclass: "small",
                    parentLabelString:  objecttype_parent_type,
                    //image: "{{ url_for('static',filename='assets/mosses.png') }}",
                    stackChildren: true
                    
                }
                
                node_array.push(new_node)
            }
        }
        
        
        for(var index=1;index<node_array.length;index++){
            //alert(node_array[index].parentLabelString + " " + node_array[index].parentLabelString)
            if(node_array[index].parentLabelString != ""){
                for(j=1;j<node_array.length;j++){
                    if(node_array[index].parentLabelString == node_array[j].text.name){
                        node_array[index]["parent"] = node_array[j]
                    }
                }
                //
            }else{
                node_array[index]["parent"] = root_node
            }
            
        }
        
        config = {
            container: "#objecttype_treant_display_area",
            levelSeparation:    25,
            siblingSeparation:  50,
            subTeeSeparation:   40,
            nodeAlign: "BOTTOM",
            scrollbar: "fancy",
            animation: {
                nodeSpeed: 1000,
                connectorsAnimation: "easeInOutCirc"
                },
            padding: 35,
            node: { HTMLclass: "evolution-tree" },
            connectors: {
                type: "step",
                style: {
                    "stroke-width": 2,
                    "stroke-linecap": "round",
                    "stroke": "#111"
                }
            },
            animateOnInit: false
        };
        
        tree_structure = [config];
        
        for(var i=0;i<node_array.length;i++){
            tree_structure.push(node_array[i])
        }
        
        new Treant( tree_structure );
        
    }
    
    function generate_objecttype_treant_display(){
        
        $.getJSON($SCRIPT_ROOT + '/_get_objecttypes', {
            domain_id   :  document.getElementById("geninfo_id").value
        }, function(data) {
            update_objecttype_treant_display(data.result)
        });
    }
    
</script>
<!-- //==== -->
<div class="content-section">

    <div class="row form-group">
        <div class="col-md-10">
            <div id="objecttype_treant_display_area">
            </div>
        </div>
    </div>
    
    <div class="row form-group">
        <div class="col-md-8">
            <h3 class="display-5">Object Types</h3>
            <div class="small text-info font-italic">
            <!--*Tooltip area thingie -->
            </div>
        </div>
        <div class="col-md-2">
            <!-- Trigger the modal with a button -->
            {% if (user_id == domain_instance.created_by) or ("WRITE" in domain_instance.visibility) %}
            <button type="button" 
                    class="btn btn-info btn-sm" 
                    data-toggle="modal" 
                    data-target="#objecttype_editmodal"
                    onclick="objecttype_add_onclick()">
                Add Object Type
            </button>
            {% else %}
            
            {% endif %}
        </div>
            
        <!-- Edit Space-->
        <div class="modal fade" id="objecttype_editmodal" role="dialog">
            <div class="modal-dialog">
            
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  
                  <h4 class="modal-title">Object Type Definition</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                
                    <p class="small text-info font-italic"><!--Some text in the modal. --></p>
                  
                    <div class="row form-group">
                        <div class="col-md-4">
                        Object type
                            <div class="small text-info font-italic">
                            *Alphanumeric and underscore characters allowed; no spaces
                            </div>
                        </div>
                        <div class="col-md-5">
                            <input class='form-control'  id="objecttype_prevobj_type" type="text" size="16" style="display:none;">
                            <input class='form-control'  id="objecttype_object_type" type="text" size="16">
                        </div>
                    </div>
                    
                    <div class="row form-group">
                        <div class="col-md-4">
                        Parent type
                        </div>
                        
                        <div class="col-md-5">
                            <div id="objecttype_parent_type_container">
                                <select class='form-control'  id="objecttype_parent_type">
                                <option value="none">None</option>
                                {% for some_object_type in object_types %}
                                <option value="{{ some_object_type.object_type }}">{{ some_object_type.object_type }}</option>
                                {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                  <button id="objecttype_add" type="button" class="btn btn-default border-info" data-dismiss="modal" onclick="objecttype_add()">Add</button>
                  <button id="objecttype_cancel" type="button" class="btn btn-default border-info" data-dismiss="modal">Cancel</button>
                </div>
                
              </div>
              
            </div>
        </div>
    
    </div>
    
    <!-- Existing object types -->
    <div>
        
        <div id="current_objects_display_area">
            {% for some_object_type in object_types %}
            <div class="row pt-1 div-hover" id="objecttype_{{ some_object_type.object_type }}_main_row">
                <div class="col-sm-8">
                    {% if some_object_type.parent_type=="" %}
                    ({{ some_object_type.object_type }}, <span class="font-italic text-muted">none</span>) 
                    {% else %}
                    ({{ some_object_type.object_type }}, {{ some_object_type.parent_type }}) 
                    {% endif %}
                    {% if some_object_type.default_flag == "default" %}
                    <span class="small text-info animated fadeIn">Default</small>
                    {% endif %}
                    <input class='form-control'  type="hidden" disabled id="objecttype_{{ some_object_type.object_type }}_prevobj_type" value="{{ some_object_type.object_type }}"/>
                    <input class='form-control'  type="hidden" disabled id="objecttype_{{ some_object_type.object_type }}_object_type" value="{{ some_object_type.object_type }}"/>
                    <input class='form-control'  type="hidden" disabled id="objecttype_{{ some_object_type.object_type }}_parent_type" value="{{ some_object_type.parent_type }}"/>
                </div>
                <div class="col-sm-4">
                
                {% if (user_id == domain_instance.created_by) or ("WRITE" in domain_instance.visibility) %}
                <button id="objecttype_{{ some_object_type.object_type }}_edit_button" 
                        type="button" 
                        class="btn btn-info btn-sm" 
                        data-toggle="modal" 
                        data-target="#objecttype_editmodal"
                        onclick="objecttype_edit_onclick('objecttype_{{ some_object_type.object_type }}')"
                        {% if some_object_type.default_flag == "default" %}
                        disabled
                        {% endif %}
                        >
                    Edit Type
                </button>
                
                <button id="objecttype_{{ some_object_type.object_type }}_delete_button" 
                        type="button" 
                        class="btn btn-info btn-sm" 
                        onclick="objecttype_delete_objecttype_onclick('objecttype_{{ some_object_type.object_type }}')"
                        disabled
                        >
                    Delete Type
                </button>
                {% else %}
                
                {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <script>
    generate_objecttype_treant_display()
    </script>
</div>
    
<!----------- [ STATE PREDICATES ] -->
<script type="text/javascript">

    function statepredicate_parameter_count_selector_onchange(){
        for(var i=1;i<=_MAX_STATEPREDICATE_PARAMETERS;i++){
            if(i <= document.getElementById("statepredicate_parameter_count_selector").value){
                //ENABLE
                document.getElementById("statepredicate_parameter"+i+"_main_row").classList.remove("collapse")
            }else{
                //DISABLE
                document.getElementById("statepredicate_parameter"+i+"_main_row").classList.add("collapse")
            }
        }
    }
    
    function create_statepredicate_parameters_display_area(all_qty, show_qty){
        
        output_HTML = ""
        //output_HTML = output_HTML + "        <div class='col-md-12'>\n"
        output_HTML = output_HTML + "        <table class='table table-hover small'>\n"
        
        output_HTML = output_HTML + "        <thead class='thead-dark'>\n"
        output_HTML = output_HTML + "            <tr>\n"
        output_HTML = output_HTML + "                <th class='align-top'>Label</th>\n"
        output_HTML = output_HTML + "                <th class='align-top'>Type</th>\n"
        output_HTML = output_HTML + "                <th class='align-top'>Min. instances</th>\n"
        output_HTML = output_HTML + "                <th class='align-top'>Max. instances</th>\n"
        output_HTML = output_HTML + "            </tr>\n"
        output_HTML = output_HTML + "        </thead>\n"
        
        output_HTML = output_HTML + "        <tbody>\n"
        for(ctr=1;ctr<=all_qty;ctr++){
            
            if(ctr <= show_qty){
                output_HTML = output_HTML + "        <tr id='statepredicate_parameter"+ctr+"_main_row'>\n"
            }else{
                output_HTML = output_HTML + "        <tr id='statepredicate_parameter"+ctr+"_main_row' class='collapse'>\n"
            }
            
            output_HTML = output_HTML + "                <td>\n"
            output_HTML = output_HTML + "                <input class='form-control form-control-sm' id='statepredicate_parameter"+ctr+"_parameter_label' onchange='statepredicate_onchange()' type='text' size='8'>\n"
            output_HTML = output_HTML + "                </td>\n"
            
            output_HTML = output_HTML + "                <td>\n"
            output_HTML = output_HTML + "                <select class='form-control form-control-sm' id='statepredicate_parameter"+ctr+"_parameter_type' onchange='statepredicate_onchange()'>\n"
            output_HTML = output_HTML + "                  <option value=''>--Select one--</option>\n"
            {% for some_object_type in object_types %}
            output_HTML = output_HTML + "                  <option value='{{ some_object_type.object_type }}'>{{ some_object_type.object_type }}</option>\n"
            {% endfor %}
            output_HTML = output_HTML + "                </select>\n"
            output_HTML = output_HTML + "                </td>\n"
            
            output_HTML = output_HTML + "                <td>\n"
            output_HTML = output_HTML + "                <select class='form-control form-control-sm'  id='statepredicate_parameter"+ctr+"_min_instances'>\n"
            output_HTML = output_HTML + "                   <option value='0'>0</option>\n"
            output_HTML = output_HTML + "                   <option value='1' selected>1</option>\n"
            output_HTML = output_HTML + "                   <option value='many'>many</option>\n"
            output_HTML = output_HTML + "                </select>\n"
            output_HTML = output_HTML + "                </td>\n"
            
            output_HTML = output_HTML + "                <td>\n"
            output_HTML = output_HTML + "                <select class='form-control form-control-sm'  id='statepredicate_parameter"+ctr+"_max_instances'>\n"
            output_HTML = output_HTML + "                   <option value='0'>0</option>\n"
            output_HTML = output_HTML + "                   <option value='1' selected>1</option>\n"
            output_HTML = output_HTML + "                   <option value='many'>many</option>\n"
            output_HTML = output_HTML + "                </select>\n"
            output_HTML = output_HTML + "                </td>\n"
            
            output_HTML = output_HTML + "            </tr>\n"
        }
        output_HTML = output_HTML + "           </tbody>\n"
        output_HTML = output_HTML + "        </table>\n"
        //output_HTML = output_HTML + "        </div>\n"
        
        document.getElementById("statepredicate_parameters_display_area").innerHTML = output_HTML
    }
    
    function statepredicate_edit_onclick(input_id){
        
        //--------
        count_selector_total = 0
        for(var i=1;i<=_MAX_STATEPREDICATE_PARAMETERS;i++){
            if(document.getElementById(input_id + '_parameter'+i+'_label').value != ""){
                count_selector_total++
            }
        }
        document.getElementById('statepredicate_parameter_count_selector').value = count_selector_total
        statepredicate_parameter_count_selector_onchange()
        //--------
        document.getElementById('statepredicate_prevpred_label').value = document.getElementById(input_id + '_prevpred_label').value
        document.getElementById('statepredicate_predicate_label').value = document.getElementById(input_id + '_predicate_label').value
        

        //statepredicate_parameter1_min_instances
        
        document.getElementById('statepredicate_parameter1_parameter_label').value = document.getElementById(input_id + '_parameter1_label').value
        document.getElementById('statepredicate_parameter1_parameter_type').value  = document.getElementById(input_id + '_parameter1_type').value 
        document.getElementById('statepredicate_parameter1_min_instances').value  = document.getElementById(input_id + '_parameter1_min_instances').value 
        document.getElementById('statepredicate_parameter1_max_instances').value  = document.getElementById(input_id + '_parameter1_max_instances').value 
        
        document.getElementById('statepredicate_parameter2_parameter_label').value = document.getElementById(input_id + '_parameter2_label').value
        document.getElementById('statepredicate_parameter2_parameter_type').value  = document.getElementById(input_id + '_parameter2_type').value 
        document.getElementById('statepredicate_parameter2_min_instances').value  = document.getElementById(input_id + '_parameter2_min_instances').value 
        document.getElementById('statepredicate_parameter2_max_instances').value  = document.getElementById(input_id + '_parameter2_max_instances').value 

        document.getElementById('statepredicate_parameter3_parameter_label').value = document.getElementById(input_id + '_parameter3_label').value
        document.getElementById('statepredicate_parameter3_parameter_type').value  = document.getElementById(input_id + '_parameter3_type').value 
        document.getElementById('statepredicate_parameter3_min_instances').value  = document.getElementById(input_id + '_parameter3_min_instances').value 
        document.getElementById('statepredicate_parameter3_max_instances').value  = document.getElementById(input_id + '_parameter3_max_instances').value 

        document.getElementById('statepredicate_parameter4_parameter_label').value = document.getElementById(input_id + '_parameter4_label').value
        document.getElementById('statepredicate_parameter4_parameter_type').value  = document.getElementById(input_id + '_parameter4_type').value 
        document.getElementById('statepredicate_parameter4_min_instances').value  = document.getElementById(input_id + '_parameter4_min_instances').value 
        document.getElementById('statepredicate_parameter4_max_instances').value  = document.getElementById(input_id + '_parameter4_max_instances').value 

        //document.getElementById('statepredicate_parameter5_parameter_label').value = document.getElementById(input_id + '_parameter5_label').value
        //document.getElementById('statepredicate_parameter5_parameter_type').value  = document.getElementById(input_id + '_parameter5_type').value 
        //document.getElementById('statepredicate_parameter1_min_instances').value  = document.getElementById(input_id + '_min_instances').value 
        //document.getElementById('statepredicate_parameter1_max_instances').value  = document.getElementById(input_id + '_max_instances').value 

        //document.getElementById('statepredicate_parameter6_parameter_label').value = document.getElementById(input_id + '_parameter6_label').value
        //document.getElementById('statepredicate_parameter6_parameter_type').value  = document.getElementById(input_id + '_parameter6_type').value 
        //document.getElementById('statepredicate_parameter1_min_instances').value  = document.getElementById(input_id + '_min_instances').value 
        //document.getElementById('statepredicate_parameter1_max_instances').value  = document.getElementById(input_id + '_max_instances').value 
        
        statepredicate_onchange()
        //document.getElementById('statepredicate_primary_object').value = document.getElementById(input_id + '_primary_object').value
        //document.getElementById('statepredicate_secondary_object').value = document.getElementById(input_id + '_secondary_object').value
        
        document.getElementById('statepredicate_humanreadable_string_1_input').value = document.getElementById(input_id + '_humanreadable_string1').value
        document.getElementById('statepredicate_humanreadable_string_2_input').value = document.getElementById(input_id + '_humanreadable_string2').value
        document.getElementById('statepredicate_humanreadable_string_3_input').value = document.getElementById(input_id + '_humanreadable_string3').value
        document.getElementById('statepredicate_humanreadable_string_4_input').value = document.getElementById(input_id + '_humanreadable_string4').value
        
        document.getElementById('statepredicate_definition_str').value = document.getElementById(input_id + '_definition_str').value
        document.getElementById('statepredicate_function_string').value = document.getElementById(input_id + '_function_string').value
        
        document.getElementById('statepredicate_initial_state_affinity').value = document.getElementById(input_id + '_initial_state_affinity').value
        document.getElementById('statepredicate_initial_intention_affinity').value = document.getElementById(input_id + '_initial_intention_affinity').value
    }
    
    function statepredicate_getFunctionString(){
        
        var output_str = ""
        
        if(document.getElementById("statepredicate_predicate_label").value != ""){
            raw_label = document.getElementById("statepredicate_predicate_label").value;
            // TODO: need to make legal:  ^\w+$
            raw_label = raw_label.replace(" ","_");
            
            output_str += raw_label + "("
        }
        
        for(var i=1;i<=_MAX_STATEPREDICATE_PARAMETERS;i++){
            if(document.getElementById("statepredicate_parameter"+i+"_parameter_label").value != ""){
                raw_label = document.getElementById("statepredicate_parameter"+i+"_parameter_label").value;
                param_type = document.getElementById("statepredicate_parameter"+i+"_parameter_type").value;
                // TODO: need to make legal:  ^\w+$
                raw_label = raw_label.replace(" ","_");
                
                if(i>1){
                    output_str += ",?" + raw_label
                }else{
                    output_str += "?" + raw_label
                }
            }
        }
        output_str += ")"
        
        return(output_str)

    }
    
    function statepredicate_getDefinitionString(){
        
        var output_str = "["
        
        if(document.getElementById("statepredicate_predicate_label").value != ""){
            raw_label = document.getElementById("statepredicate_predicate_label").value;
            // TODO: need to make legal:  ^\w+$
            raw_label = raw_label.replace(" ","_");
            
            output_str += "'" + raw_label + "'"
        }
        
        for(var i=1;i<=_MAX_STATEPREDICATE_PARAMETERS;i++){
            if(document.getElementById("statepredicate_parameter"+i+"_parameter_label").value != ""){
                raw_label = document.getElementById("statepredicate_parameter"+i+"_parameter_label").value;
                param_type = document.getElementById("statepredicate_parameter"+i+"_parameter_type").value;
                // TODO: need to make legal:  ^\w+$
                raw_label = raw_label.replace(" ","_");
                
                output_str += ", [?'" + raw_label + "', '" + param_type + "']"
            }
        }
        output_str += "]"
        
        return(output_str)

    }
    
    function statepredicate_onchange(){
        var current_parameters = []
        
        for(var i=1;i<=_MAX_STATEPREDICATE_PARAMETERS;i++){
            if(document.getElementById("statepredicate_parameter"+i+"_parameter_label").value != ""){
                raw_label = document.getElementById("statepredicate_parameter"+i+"_parameter_label").value;
                param_type = document.getElementById("statepredicate_parameter"+i+"_parameter_type").value;
                // TODO: need to make legal:  ^\w+$
                raw_label = raw_label.replace(" ","_");
                
                current_parameters.push([raw_label,param_type]);
            }
        }
        
        //--------------------
        var output_str = ""
        output_str += "<select class='form-control'  id=\"statepredicate_primary_object\">\n"
        for (var i=0; i < current_parameters.length; i++) {
            value = "[&#39;?"+current_parameters[i][0]+"&#39;, &#39;"+current_parameters[i][1]+"&#39;]"
            output_str += "<option value='"+value+"'>"
            output_str += "(?"+current_parameters[i][0]+" - "+current_parameters[i][1]+")"
            output_str += "</option>\n"
        }
        output_str += "</select>\n"
        $('#statepredicate_editmodal_primary_obj').html(output_str)
        
        //--------------------
        var output_str = ""
        output_str += "<select class='form-control'  id=\"statepredicate_secondary_object\">\n"
        output_str += "<option value=''>-none-</option>"
        
        for (var i=0; i < current_parameters.length; i++) {
            value = "[&#39;?"+current_parameters[i][0]+"&#39;, &#39;"+current_parameters[i][1]+"&#39;]"
            output_str += "<option value='"+value+"'>"
            output_str += "(?"+current_parameters[i][0]+" - "+current_parameters[i][1]+")"
            output_str += "</option>\n"
        }
        output_str += "</select>\n"                        
        $('#statepredicate_editmodal_secondary_obj').html(output_str)
        
        //--------------------
        
        function_str = statepredicate_getFunctionString()
        definition_str = statepredicate_getDefinitionString()
        
        $('#statepredicate_editmodal_function_string_preview').html(function_str + "<br>" + definition_str)
        document.getElementById("statepredicate_definition_str").value = definition_str
        document.getElementById("statepredicate_function_string").value = function_str
    }
    
    function statepredicate_add(){
        
        
        // Check if label is a duplicate
        predicate_label = document.getElementById("statepredicate_predicate_label").value
        
        $.getJSON($SCRIPT_ROOT + '/_get_state_predicate_def_count_by_label', {
            
            domain_id       :  "{{ domain_instance.id }}",
            predicate_label :  predicate_label
            
        }, function(data) {
            //if(data.result == "0"){
            
            parameter = new Array()
            for(var i=0;i<_MAX_STATEPREDICATE_HUMANREADABLES;i++){
                
                if(i >= document.getElementById("statepredicate_parameter_count_selector").value){
                    document.getElementById("statepredicate_parameter"+(i+1)+"_parameter_label").value = ""
                    document.getElementById("statepredicate_parameter"+(i+1)+"_parameter_type").value = ""
                    
                    parameter.push(["",""])
                }else{
                    some_label      = document.getElementById("statepredicate_parameter"+(i+1)+"_parameter_label").value.trim()
                    some_type       = document.getElementById("statepredicate_parameter"+(i+1)+"_parameter_type").value
                    some_min_inst   = document.getElementById("statepredicate_parameter"+(i+1)+"_min_instances").value
                    some_max_inst   = document.getElementById("statepredicate_parameter"+(i+1)+"_max_instances").value
                    parameter.push(["?"+some_label,some_type,some_min_inst,some_max_inst])
                }
            }
            
            humanreadable_string = new Array()
            for(var i=0;i<_MAX_STATEPREDICATE_HUMANREADABLES;i++){
                tempstring = document.getElementById("statepredicate_humanreadable_string_"+(i+1)+"_input").value.trim()
                if(tempstring != ""){
                    humanreadable_string.push('"'+tempstring+'"')
                }else{
                    humanreadable_string.push('')
                }
            }
            
            initial_state_affinity = document.getElementById("statepredicate_initial_state_affinity").value
            initial_intention_affinity = document.getElementById("statepredicate_initial_intention_affinity").value
            
            mutability = "CUSTOM"
            visibility = ""
            
            
            //  Checking validity
            
            if(is_valid_statepredicate()){
                document.getElementById("statepredicate_editmodal").classList.remove("show")
                
                primary_object = document.getElementById("statepredicate_primary_object").value
                //primary_object = labelToArrayString(primary_object)
                
                secondary_object = document.getElementById("statepredicate_secondary_object").value
                //secondary_object = labelToArrayString(secondary_object)
                
                $.getJSON($SCRIPT_ROOT + '/_add_domain_predicate_def', {
                    
                    domain_id                   :  document.getElementById("geninfo_id").value                      ,
                    domain_full_label           :  "{{ domain_instance.domain_full_label }}"                        ,
                    prevpred_label              :  document.getElementById("statepredicate_prevpred_label").value   ,
                    predicate_label             :  document.getElementById("statepredicate_predicate_label").value  ,
                    
                    parameter1_label            :  parameter[0][0] ,
                    parameter1_type             :  parameter[0][1] ,
                    parameter1_min_instances    :  parameter[0][2] ,
                    parameter1_max_instances    :  parameter[0][3] ,

                    parameter2_label            :  parameter[1][0] ,
                    parameter2_type             :  parameter[1][1] ,
                    parameter2_min_instances    :  parameter[1][2] ,
                    parameter2_max_instances    :  parameter[1][3] ,

                    parameter3_label            :  parameter[2][0] ,
                    parameter3_type             :  parameter[2][1] ,
                    parameter3_min_instances    :  parameter[2][2] ,
                    parameter3_max_instances    :  parameter[2][3] ,

                    parameter4_label            :  parameter[3][0] ,
                    parameter4_type             :  parameter[3][1] ,
                    parameter4_min_instances    :  parameter[3][2] ,
                    parameter4_max_instances    :  parameter[3][3] ,
                    
                    primary_object              :  primary_object   ,
                    secondary_object            :  secondary_object ,   
                            
                    humanreadable_string1       :  humanreadable_string[0]        ,
                    humanreadable_string2       :  humanreadable_string[1]        ,
                    humanreadable_string3       :  humanreadable_string[2]        ,
                    humanreadable_string4       :  humanreadable_string[3]        ,
                            
                    initial_state_affinity      :  initial_state_affinity         ,
                    initial_intention_affinity  :  initial_intention_affinity     ,
                    
                    mutability                  :  mutability                     ,
                    visibility                  :  visibility                     ,
                    
                    //attribute1
                    //attribute2
                    //attribute3
                            
                    definition_str              :  document.getElementById("statepredicate_definition_str").value ,
                    function_string             :  document.getElementById("statepredicate_function_string").value
                    
                }, function(data) {
                    
                    window.location.href = '/domain_instance/#objects_section';
                    window.location.reload(true)

                });
            
            }else{
                //alert("Invalid state predicate")
                //add_flash_message("Invalid state predicate","danger","default","statepredicate_input_flash_area","target")
                add_flash_message("Invalid state predicate","danger","default","header_flash_message_area","target")
                document.getElementById("statepredicate_editmodal").classList.add("show")
            }
            
            //}else{
            //    alert("ERROR: A predicate with label '"+predicate_label+"' already exists")
            //}
        
        
        });
        

    }
    
    function is_valid_statepredicate(){
        
        return_value = true
        // Predicate label
        //   - Check if blank
        if(document.getElementById("statepredicate_predicate_label").value.trim() == ""){
            if(return_value){
                return_value = false
                alert("Pred - no label")
            }
        }
        //   - Check for invalid characters
        
        // Parameters
        parameter_count = document.getElementById("statepredicate_parameter_count_selector").value
        for(var i=1;i<=parameter_count;i++){
            
            if(document.getElementById("statepredicate_parameter"+i+"_parameter_label").value.trim() == ""){
                if(return_value){
                    return_value = false
                    alert("Param - no label")
                }
            }
            if(document.getElementById("statepredicate_parameter"+i+"_parameter_type").value.trim() == ""){
                if(return_value){
                    return_value = false
                    alert("Param - invalid type")
                }
            }
        }
        
        // Human Readable Strings
        //  - Minimum of one
        
        found_flag = false
        for(var i=0;i<_MAX_STATEPREDICATE_HUMANREADABLES;i++){
            tempstring = document.getElementById("statepredicate_humanreadable_string_"+(i+1)+"_input").value.trim()
            if(tempstring != ""){
                found_flag = true
                if(return_value){
                    return_value = humanreadable_verify('statepredicate',(i+1)+"",4)
                    if(!return_value){
                        alert("HR - invalid")
                    }
                }
            }else{

                
            }
        }
        if(!found_flag){
            if(return_value){
                alert("HR - no found")
                return_value = false
            }
        }
        
        // Passed everythinig
        return return_value
    }
    
    function statepredicate_add_onclick(){
        document.getElementById('statepredicate_prevpred_label').value  = ""
        document.getElementById('statepredicate_predicate_label').value = ""
        
        document.getElementById('statepredicate_parameter1_parameter_label').value = ""
        document.getElementById('statepredicate_parameter1_parameter_type').value  = ""
        document.getElementById('statepredicate_parameter2_parameter_label').value = ""
        document.getElementById('statepredicate_parameter2_parameter_type').value  = ""
        document.getElementById('statepredicate_parameter3_parameter_label').value = ""
        document.getElementById('statepredicate_parameter3_parameter_type').value  = ""
        document.getElementById('statepredicate_parameter4_parameter_label').value = ""
        document.getElementById('statepredicate_parameter4_parameter_type').value  = ""

        //statepredicate_onchange()
        //document.getElementById('statepredicate_primary_object').value = document.getElementById(input_id + '_primary_object').value
        //document.getElementById('statepredicate_secondary_object').value = document.getElementById(input_id + '_secondary_object').value
        
        document.getElementById('statepredicate_humanreadable_string_1_input').value = ""
        document.getElementById('statepredicate_humanreadable_string_2_input').value = ""
        document.getElementById('statepredicate_humanreadable_string_3_input').value = ""
        document.getElementById('statepredicate_humanreadable_string_4_input').value = ""
        
        document.getElementById('statepredicate_definition_str').value  = ""
        document.getElementById('statepredicate_function_string').value = ""
    }
    
    function humanreadable_verify(caller, index, max_parameters){
        
        input_text = document.getElementById(caller+"_humanreadable_string_"+index+"_input").value
        
        is_valid = true
        //alert("input_text: " + input_text)
        //alert(caller+"_humanreadable_string_"+index+"_input")
        
        if(input_text != ""){
            for(var i=1;i<=max_parameters;i++){
                some_parameter = document.getElementById(caller+"_parameter"+i+"_parameter_label").value
                //alert("?"+some_parameter + " is in "+ input_text + " : " + caller)
                if(some_parameter != ""){
                    if(!input_text.includes("?"+some_parameter)){
                        is_valid = false
                        break
                    }
                }
            }
        }
        if(!is_valid){
            document.getElementById(caller+"_humanreadable_string_"+index+"_input").focus()
            //add_flash_message("Human readable string "+index+" is invalid. Please modify","danger","default","action_humanreadable_input_flash_area","target")
            add_flash_message("Human readable string "+index+" is invalid. Please modify","danger","default","header_flash_message_area","target")
        }else{
            
        }
        
        return is_valid
    }
</script>

<!-- //==== -->
<div class="content-section" id="statepredicate_section">
    
    <div class="row form-group">
        <div class="col-md-8">
            <h3 class="display-5">State Predicates</h3>
            <div class="small text-info font-italic">
            <!--*Tooltip area thingie -->
            </div>
        </div>
        <div class="col-md-2">
            <!-- Trigger the modal with a button -->
            {% if (user_id == domain_instance.created_by) or ("WRITE" in domain_instance.visibility) %}
            <button type="button" 
                    class="btn btn-info btn-sm" 
                    data-toggle="modal" 
                    data-target="#statepredicate_editmodal" 
                    onclick="statepredicate_add_onclick()">
                Add Predicate
            </button>
            {% endif %}
        </div>
            
        <!-- Edit Space-->
        <div class="modal fade" id="statepredicate_editmodal" role="dialog">
            <div class="modal-dialog">
            
              <!-- Modal content-->
              <div class="modal-content width-600">
                <div class="modal-header">
                  
                  <h4 class="modal-title">State Predicate Definition</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                
                  <div class="row form-group">
                      <div class="col-md-12" id="statepredicate_input_flash_area">
                      </div>
                  </div>
                  
                  
                  <p class="small text-info font-italic"><!--Some text in the modal. --></p>
                  
                  <div class="row form-group">
                      <div class="col-md-4">
                      Predicate Label
                          <div class="small text-info font-italic">
                          *Alphanumeric and underscore characters allowed; no spaces
                          </div>
                      </div>
                      <div class="col-md-5">
                          <input class='form-control'  id="statepredicate_prevpred_label" type="text" size="16" style="display:none;">
                          <input class='form-control'  id="statepredicate_predicate_label" type="text" size="16" onchange="statepredicate_onchange()">
                      </div>
                  </div>
                
                  <div class="row form-group">
                      <div class="col-md-4">
                      Parameters
                      </div>
                      <div class="col-md-5">
                        <select class='form-control' id="statepredicate_parameter_count_selector" onchange="statepredicate_parameter_count_selector_onchange()">
                          <option value="1">1</option>
                          <option value="2">2</option>
                          <option value="3">3</option>
                          <option value="4">4</option>
                        </select>
                      </div>
                  </div>
                  
                  <div id="statepredicate_parameters_display_area">
                  </div>
                  <script>
                    create_statepredicate_parameters_display_area(4,1);
                  </script>
                    
                  <div class="row form-group">
                      <hr>
                      <div class="col-md-10">
                          <div id="statepredicate_editmodal_function_string_preview" class="small">
                          
                          </div>
                          <input class='form-control'  id="statepredicate_definition_str" type="hidden" disabled size="16">
                          <input class='form-control'  id="statepredicate_function_string" type="hidden" disabled size="16">
                      </div>
                      <hr>
                  </div>
            
                  <div class="row form-group">
                      <div class="col-md-4">
                      Primary Object
                      </div>
                      <div id="statepredicate_editmodal_primary_obj" class="col-md-5">
                  
                      </div>
                  </div>
                
                  <div class="row form-group">
                      <div class="col-md-4">
                      Secondary Object
                      </div>
                      <div id="statepredicate_editmodal_secondary_obj" class="col-md-5">
                  
                      </div>
                  </div>
                  
                  <div class="row form-group">
                      <div class="col-md-12 ">
                        <div class="alert alert-info">
                          Note that state predicates needs at least ONE human readable string
                        </div>
                      </div>
                  </div>
                  <div class="row form-group">
                      <div class="col-md-4">
                      Human Readable Strings
                      </div>
                      <div class="col-md-6">
                          <textarea class='form-control'  id="statepredicate_humanreadable_string_1_input" rows="3" cols="30" onchange="humanreadable_verify('statepredicate','1',4)"></textarea> <br>
                          <textarea class='form-control'  id="statepredicate_humanreadable_string_2_input" rows="3" cols="30" onchange="humanreadable_verify('statepredicate','2',4)"></textarea> <br>
                          <textarea class='form-control'  id="statepredicate_humanreadable_string_3_input" rows="3" cols="30" onchange="humanreadable_verify('statepredicate','3',4)"></textarea> <br>
                          <textarea class='form-control'  id="statepredicate_humanreadable_string_4_input" rows="3" cols="30" onchange="humanreadable_verify('statepredicate','4',4)"></textarea> <br>
                      </div>
                  </div>
                  
                  <div class="dropdown-divider"></div>
                  
                  <div class="row form-group">
                      <div class="col-md-12 ">
                        <div class="alert alert-info">
                          Advanced stuff! You can further control the predicate's behavior here by defining settings like cardinality.
                        </div>
                      </div>
                  </div>
                  <div class="row form-group">
                      <div class="col-md-4">
                      Initial State Affinity
                          <div class="small text-info font-italic">
                          *Likelihood that this predicate spawns as a predicate in initial states. 
                          </div>
                      </div>
                      <div class="col-md-6">
                        <select class="form-control" id="statepredicate_initial_state_affinity">
                        <option value=0.0>0%</option>
                        <option value=0.1>10%</option>
                        <option value=0.2 selected>20%</option>
                        <option value=0.3>30%</option>
                        <option value=0.4>40%</option>
                        <option value=0.5>50%</option>
                        <option value=0.6>60%</option>
                        <option value=0.7>70%</option>
                        <option value=0.8>80%</option>
                        <option value=0.9>90%</option>
                        <option value=1.0>100%</option>
                        </select>
                      </div>
                  </div>
                  <div class="row form-group">
                      <div class="col-md-4">
                      Initial Intention Affinity
                          <div class="small text-info font-italic">
                          *Likelihood that this predicate spawns as an intention predicate during narrative planning
                          </div>
                      </div>
                      <div class="col-md-6">
                        <select class="form-control" id="statepredicate_initial_intention_affinity">
                        <option value=0.0>0%</option>
                        <option value=0.1>10%</option>
                        <option value=0.2 selected>20%</option>
                        <option value=0.3>30%</option>
                        <option value=0.4>40%</option>
                        <option value=0.5>50%</option>
                        <option value=0.6>60%</option>
                        <option value=0.7>70%</option>
                        <option value=0.8>80%</option>
                        <option value=0.9>90%</option>
                        <option value=1.0>100%</option>
                        </select>
                      </div>
                  </div>
                  
                </div>
                <div class="modal-footer">
                  <button id="statepredicate_add"    type="button" class="btn btn-default border-info" onclick="statepredicate_add()">Verify and Add</button>
                  <button id="statepredicate_cancel" type="button" class="btn btn-default border-info" data-dismiss="modal">Cancel</button>
                  
                </div>
              </div>
              
            
        
            </div>
        </div>
    
    </div>
    
    <!-- Existing predicates -->
    <div>
        
        {% for some_predicate in state_predicate_defs %}
        {% if some_predicate.visibility != "INVISIBLE" %}
        <div class="row pt-1 div-hover">
            <div class="col-sm-8">
                {{ some_predicate.function_string }}
                
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_prevpred_label" value="{{ some_predicate.predicate_label }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_predicate_label" value="{{ some_predicate.predicate_label }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_definition_str" value="{{ some_predicate.definition_str }}"/>
                
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter1_label" value="{{ some_predicate.parameter1_label.replace('?','') }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter1_type" value="{{ some_predicate.parameter1_type }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter1_min_instances" value="{{ some_predicate.parameter1_min_instances }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter1_max_instances" value="{{ some_predicate.parameter1_max_instances }}"/>
                
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter2_label" value="{{ some_predicate.parameter2_label.replace('?','') }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter2_type" value="{{ some_predicate.parameter2_type }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter2_min_instances" value="{{ some_predicate.parameter2_min_instances }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter2_max_instances" value="{{ some_predicate.parameter2_max_instances }}"/>

                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter3_label" value="{{ some_predicate.parameter3_label.replace('?','') }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter3_type" value="{{ some_predicate.parameter3_type }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter3_min_instances" value="{{ some_predicate.parameter3_min_instances }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter3_max_instances" value="{{ some_predicate.parameter3_max_instances }}"/>

                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter4_label" value="{{ some_predicate.parameter4_label.replace('?','') }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter4_type" value="{{ some_predicate.parameter4_type }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter4_min_instances" value="{{ some_predicate.parameter4_min_instances }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter4_max_instances" value="{{ some_predicate.parameter4_max_instances }}"/>

                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter5_label" value="{{ some_predicate.parameter5_label.replace('?','') }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter5_type" value="{{ some_predicate.parameter5_type }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter5_min_instances" value="{{ some_predicate.parameter5_min_instances }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter5_max_instances" value="{{ some_predicate.parameter5_max_instances }}"/>

                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter6_label" value="{{ some_predicate.parameter6_label.replace('?','') }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter6_type" value="{{ some_predicate.parameter6_type }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter6_min_instances" value="{{ some_predicate.parameter6_min_instances }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_parameter6_max_instances" value="{{ some_predicate.parameter6_max_instances }}"/>


                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_primary_object" value="{{ some_predicate.primary_object }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_secondary_object" value="{{ some_predicate.secondary_object }}"/>
                
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_humanreadable_string1" value="{{ some_predicate.humanreadable_string1.replace('"','') }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_humanreadable_string2" value="{{ some_predicate.humanreadable_string2.replace('"','') }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_humanreadable_string3" value="{{ some_predicate.humanreadable_string3.replace('"','') }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_humanreadable_string4" value="{{ some_predicate.humanreadable_string4.replace('"','') }}"/>
                
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_function_string" value="{{ some_predicate.function_string }}"/>
                
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_initial_state_affinity" value="{{ some_predicate.initial_state_affinity }}"/>
                <input class='form-control'  type="hidden" disabled id="statepredicate_{{ some_predicate.predicate_label }}_initial_intention_affinity" value="{{ some_predicate.initial_intention_affinity }}"/>
                
            </div>
            
            <div class="col-sm-2">
            {% if (user_id == domain_instance.created_by) or ("WRITE" in domain_instance.visibility) %}
            <button id="statepredicate_edit_{{ some_predicate.predicate_label }}_edit_button" 
                    type="button" 
                    class="btn btn-info btn-sm" 
                    data-toggle="modal" 
                    data-target="#statepredicate_editmodal"
                    onclick="statepredicate_edit_onclick('statepredicate_{{ some_predicate.predicate_label }}')"
                    {% if some_predicate.mutability == "DEFAULT_off" %}
                    disabled
                    {% endif %}
                    >
                    Edit Predicate
            </button>
            {% endif %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
        
    </div>
</div>

<!----------- [ ACTIONS ] -->
<script>
    
    $(document).on("click", "#action_add_precondition_predicate_add", function() {
        // Set target
        document.getElementById('action_add_predicate_target').value="precondition"
        //alert("Set target: precondition")
        
        // Reset values
    });
    
    $(document).on("click", "#action_add_effect_predicate_add", function() {
        // Set target
        document.getElementById('action_add_predicate_target').value="effect"
        //alert("Set target: effect")
        
        // Reset values
    });
    
    $(document).on("click", "#action_add_precondition_intention_add", function() {
        // Set target
        document.getElementById('action_add_intention_predicate_target').value="precondition"
        //alert("Set target: precondition")
        
        // Reset values
    });
    
    $(document).on("click", "#action_add_effect_intention_add", function() {
        // Set target
        document.getElementById('action_add_intention_predicate_target').value="effect"
        //alert("Set target: effect")
        
        // Reset values
    });
    
    function submit_action_def_pilot(){
        
        action_label = document.getElementById("action_action_label").value
        
        $.getJSON($SCRIPT_ROOT + '/_submit_action_def_pilot', {
            domain_id               : "{{ domain_instance.id}}"                 ,
            domain_full_label       : "{{ domain_instance.domain_full_label }}" ,
            action_label            : action_label
            
        }, function(data) {
            
            document.getElementById("action_id").value = data.result
        });
    }
    
    function action_define_action_label(){ 
    
        action_label = document.getElementById("action_action_label_input").value
    
        $.getJSON($SCRIPT_ROOT + '/_get_action_def_count_by_label', {
            domain_id               : "{{ domain_instance.id}}" ,
            action_label            : action_label
            
        }, function(data) {
            
            if(data.result == "0"){

                document.getElementById("action_action_label").value = document.getElementById("action_action_label_input").value
                submit_action_def_pilot()
            
                if(document.getElementById("action_action_copyfrom").value != ""){
                    copy_from = document.getElementById("action_action_copyfrom").value
                    copy_to = document.getElementById("action_action_label_input").value
                    action_copyfrom(copy_from, copy_to)
                }
            }else{
                alert("ERROR: An action with label '"+action_label+"' alread exists")
                document.getElementById("action_input_modal_close").click()
            }
        });
        

    }
    
    function action_action_label_input_onchange(){
        //Check action label availability?
    }
    
    function action_input_reset(){
        action_input_reset_action_label()
        action_input_reset_parameters()
        action_input_reset_preconditions()
        action_input_reset_effects()
        action_input_reset_humanreadables()
    }
    
    //--Action Input Reset: Sub-functions
    function action_input_reset_action_label(){
        document.getElementById("action_action_label_input").value = ""
        document.getElementById("action_editmodal").classList.add("show")
        
    }
    
    function action_input_reset_parameters(){
        document.getElementById("action_parameter_count_selector").value = ""
        action_parameter_count_selector_onchange()
        
        //for each param
        for(var p=1;p<=_MAX_ACTION_PARAMETERS;p++){
        
            try{
                document.getElementById("action_parameter"+p+"_parameter_label").value = ""
                document.getElementById("action_parameter"+p+"_parameter_type").value = ""
                document.getElementById("action_parameter"+p+"_is_agent").checked = false
                
            }catch(err){
            
            }
        }
        document.getElementById("action_editmodal_function_string_preview").innerHTML = ""
    }
    
    function action_input_reset_preconditions(){
        document.getElementById("action_precondition_display_area_tbody").innerHTML = ""
    }
    
    function action_input_reset_effects(){
        document.getElementById("action_effect_display_area_tbody").innerHTML = ""
    }
    
    function action_input_reset_humanreadables(){
        for(var h=1;h<=_MAX_ACTION_HUMANREADABLES;h++){
            try{
                document.getElementById("action_humanreadable_string_"+h+"_input").value = ""
            }catch(err){
            
            }
        }
    }
    
    
    //------------------------------------------------------------
    
    
    function add_action_parameter(parameter_order){
        
        action_label = document.getElementById("action_action_label").value
        action_full_label = "{{ domain_instance.domain_full_label }}" + "_" + action_label
        
        parameter_label = document.getElementById("action_parameter"+parameter_order+"_parameter_label").value
        parameter_type  = document.getElementById("action_parameter"+parameter_order+"_parameter_type").value
        parameter_order = parameter_order
        
        $.getJSON($SCRIPT_ROOT + '/_add_action_parameter', {
            action_full_label   : action_full_label ,
            parameter_label     : parameter_label   ,
            parameter_type      : parameter_type    ,
            parameter_order     : parameter_order
            
        }, function(data) {
            
            // ???
        });
    }
    
    function delete_action_parameter(parameter_order){
        
        action_label = document.getElementById("action_action_label").value
        action_full_label = "{{ domain_instance.domain_full_label }}" + "_" + action_label
        
        parameter_order = parameter_order
        
        $.getJSON($SCRIPT_ROOT + '/_delete_action_parameter', {
            action_full_label   : action_full_label ,
            parameter_order     : parameter_order
            
        }, function(data) {
            
            // ???
        });
    }
    
    function action_parameter_count_selector_onchange(){
        for(var i=1;i<=_MAX_ACTION_PARAMETERS;i++){
            if(i <= document.getElementById("action_parameter_count_selector").value){
                //ENABLE
                document.getElementById("action_parameter"+i+"_main_row").classList.remove("collapse")
                //add_action_parameter(i)
            }else{
                //DISABLE
                document.getElementById("action_parameter"+i+"_main_row").classList.add("collapse")
                //delete_action_parameter(i)
            }
        }
    }
    
    function create_action_parameters_display_area(all_qty, show_qty){
        
        output_HTML = ""
        for(ctr=1;ctr<=all_qty;ctr++){
            output_HTML = output_HTML + "        <!-- // PARAMETER "+ctr+" -->\n"
            if(ctr <= show_qty){
                output_HTML = output_HTML + "        <div id='action_parameter"+ctr+"_main_row' class='row form-group pt-1'>\n"
            }else{
                output_HTML = output_HTML + "        <div id='action_parameter"+ctr+"_main_row' class='row form-group collapse pt-1'>\n"
            }
            output_HTML = output_HTML + "            <div class='col-md-3'>\n"
            output_HTML = output_HTML + "            </div>\n"
            

            
            output_HTML = output_HTML + "            <div class='col-md-8'>\n"
            output_HTML = output_HTML + "                <div class='row'>\n"
            
            
            output_HTML = output_HTML + "                    <div class='col-md-4'>\n"
            output_HTML = output_HTML + "                        <input class='form-control'  id='action_parameter"+ctr+"_parameter_label' type='text' size='8' onchange='update_action_parameter_onchange(\"action_parameter"+ctr+"\")'>\n"
            
            output_HTML = output_HTML + "                    </div>\n"
            output_HTML = output_HTML + "                    <div class='col-md-4'>\n"
            output_HTML = output_HTML + "                        <select class='form-control'  id='action_parameter"+ctr+"_parameter_type' onchange='update_action_parameter_onchange(\"action_parameter"+ctr+"\")'>\n"
            output_HTML = output_HTML + "                          <option value=''>--Object type--</option>\n"
            {% for some_object_type in object_types %}
            output_HTML = output_HTML + "                          <option value='{{ some_object_type.object_type }}'>{{ some_object_type.object_type }}</option>\n"
            {% endfor %}
            output_HTML = output_HTML + "                        </select>\n"
            output_HTML = output_HTML + "                    </div>\n"
            
            output_HTML = output_HTML + "                    <div class='col-md-3 small align-middle'>\n"
            //output_HTML = output_HTML + "                       <input class="form-check-input" id='action_parameter"+ctr+"_is_agent' type='checkbox'> <span class='font-italic muted text-info' onclick='document.getElementById(\"action_parameter"+ctr+"_is_agent\").click()'>Active agent</span>"
            output_HTML = output_HTML + "                       <input class='form-check-input' id='action_parameter"+ctr+"_is_agent' type='checkbox'>"
            output_HTML = output_HTML + "                    </div>\n"

            
            output_HTML = output_HTML + "                </div>\n"
            output_HTML = output_HTML + "            </div>\n"
            
            output_HTML = output_HTML + "            <div class='col-md-2'>\n"
            output_HTML = output_HTML + "            </div>\n"
            output_HTML = output_HTML + "        </div>\n"
        }
        document.getElementById("action_parameters_display_area").innerHTML = output_HTML
    }
    
    function update_action_parameter_onchange(action_parameter){
        
        // 1. Update parameter information
        action_parameter_count_selector_onchange()
        
        
        // 2. Update function string display
        output_HTML = ""
        action_action_label = document.getElementById("action_action_label").value
        
        output_HTML = action_action_label + "("
        for(var i=1;i<=document.getElementById("action_parameter_count_selector").value;i++){
            parameter_label = document.getElementById("action_parameter"+i+"_parameter_label").value
            parameter_type = document.getElementById("action_parameter"+i+"_parameter_type").value
            output_HTML = output_HTML + "(" + parameter_label + " - " + parameter_type +")"
        }
        output_HTML = output_HTML + ")"
        document.getElementById("action_editmodal_function_string_preview").innerHTML = output_HTML
    }
    
    function update_action_editmodal(action_result, action_parameters_result, action_full_label, copy_to_action_full_label){
        
        // Action area
        raw_rows = action_result.split("/|")
        for(var i=0; i<raw_rows.length; i++){
            split_row = raw_rows[i].split("/;")
            
            //alert(split_row)
            //alert(split_row.length)
            if(split_row.length == 15){
                action_id    = split_row[0]
                action_label = split_row[1]
                
                agents1_label   = split_row[2].replace('?','')
                agents1_type    = split_row[3]
                agents2_label   = split_row[4].replace('?','')
                agents2_type    = split_row[5]
                agents3_label   = split_row[6].replace('?','')
                agents3_type    = split_row[7]
                agents4_label   = split_row[8].replace('?','')
                agents4_type    = split_row[9]
                
                humanreadable_string1 = split_row[10].replace(/"/g,'')
                humanreadable_string2 = split_row[11].replace(/"/g,'')
                humanreadable_string3 = split_row[12].replace(/"/g,'')
                humanreadable_string4 = split_row[13].replace(/"/g,'')
            }
        }
        
        //    - Edit switch
        document.getElementById("action_edit").checked = true
        //    - Action Label
        document.getElementById("action_id").value = action_id
        document.getElementById("action_action_label").value = action_label
        
        // Parameters Area
        raw_rows = action_parameters_result.split("/|")
        
        //    - Parameter detail area
        for(var i=0; i<raw_rows.length; i++){
            split_row = raw_rows[i].split("/;")
            
            if(split_row.length == 6){
                
                parameter_id                = split_row[0]
                parameter_action_full_label = split_row[1]
                parameter_parameter_label   = split_row[2].replace('?','')
                parameter_parameter_type    = split_row[3]
                parameter_parameter_order   = split_row[4]
                
                //alert(parameter_parameter_label)
                document.getElementById("action_parameter"+(parameter_parameter_order)+"_parameter_label").value = parameter_parameter_label
                document.getElementById("action_parameter"+(parameter_parameter_order)+"_parameter_type").value  = parameter_parameter_type
                
                //   - Parameter active agents    
                if((agents1_label == parameter_parameter_label) && (agents1_label != "")){
                    document.getElementById("action_parameter"+(parameter_parameter_order)+"_is_agent").checked = true
                }
                if((agents2_label == parameter_parameter_label) && (agents1_label != "")){
                    document.getElementById("action_parameter"+(parameter_parameter_order)+"_is_agent").checked = true
                }
                if((agents3_label == parameter_parameter_label) && (agents1_label != "")){
                    document.getElementById("action_parameter"+(parameter_parameter_order)+"_is_agent").checked = true
                }
                if((agents4_label == parameter_parameter_label) && (agents1_label != "")){
                    document.getElementById("action_parameter"+(parameter_parameter_order)+"_is_agent").checked = true
                }
            }
        }
        
        //    - Parameter Count Selector
        document.getElementById("action_parameter_count_selector").value = raw_rows.length-1
        action_parameter_count_selector_onchange()
        
        // Preconditions Area
        predicate_type = "PRECON"
        $.getJSON($SCRIPT_ROOT + '/_get_action_predicates', {
            action_full_label           : action_full_label,
            predicate_type              : predicate_type,
            copy_to_action_full_label   : copy_to_action_full_label
        }, function(data) {
        
            action_predicates_result = data.result
            tbody = document.getElementById("action_precondition_display_area_tbody")            
            tbody.innerHTML = ""
            //document.getElementById("action_precondition_display_area").classList.add("collapse")
            update_action_display_area("precondition",data.result)
            
        });
        
        // Effects Area
        predicate_type = "EFFECT"
        $.getJSON($SCRIPT_ROOT + '/_get_action_predicates', {
            action_full_label           : action_full_label,
            predicate_type              : predicate_type,
            copy_to_action_full_label   : copy_to_action_full_label
        }, function(data) {
        
            action_predicates_result = data.result
            tbody = document.getElementById("action_effect_display_area_tbody")            
            tbody.innerHTML = ""
            //document.getElementById("action_effect_display_area").classList.add("collapse")
            update_action_display_area("effect",data.result)
            
        });
        
        // Human Readable Strings
        
        if(humanreadable_string1 != undefined){
            document.getElementById("action_humanreadable_string_1_input").value = humanreadable_string1
        }
        document.getElementById("action_humanreadable_string_2_input").value = humanreadable_string2
        document.getElementById("action_humanreadable_string_3_input").value = humanreadable_string3
        document.getElementById("action_humanreadable_string_4_input").value = humanreadable_string4
        
        document.getElementById("action_editmodal").classList.add("show")
        document.getElementById("actions_section").scrollIntoView()
    }
    
    function action_copyfrom(copy_from, copy_to){
    
        copy_from_action_full_label = "{{ domain_instance.domain_full_label }}_" + copy_from
        copy_to_action_full_label = "{{ domain_instance.domain_full_label }}_" + copy_to
        
        $.getJSON($SCRIPT_ROOT + '/_get_action_details', {
            action_full_label   : copy_from_action_full_label         ,
            domain_id           : {{ domain_instance.id }}  
        }, function(data) {
            
            action_id_result = data.result
            $.getJSON($SCRIPT_ROOT + '/_get_action_parameters', {
                action_full_label   : copy_from_action_full_label
            }, function(data) {
                
                action_parameters_result = data.result
                
                update_action_editmodal(action_id_result, action_parameters_result, copy_from_action_full_label, copy_to_action_full_label)
                document.getElementById("action_action_label").value = document.getElementById("action_action_label_input").value
                
            });
        });
    }
    
    function action_edit_action_onclick(input_id){
        
        action_full_label = document.getElementById(input_id+"_action_full_label").value
        //alert(action_full_label)
        
        document.getElementById("action_precondition_display_area").classList.add("collapse")
        document.getElementById("action_effect_display_area").classList.add("collapse")
        
        $.getJSON($SCRIPT_ROOT + '/_get_action_details', {
            action_full_label   : action_full_label         ,
            domain_id           : {{ domain_instance.id }}  
        }, function(data) {
            
            action_id_result = data.result
            $.getJSON($SCRIPT_ROOT + '/_get_action_parameters', {
                action_full_label   : action_full_label
            }, function(data) {
                
                action_parameters_result = data.result
                update_action_editmodal(action_id_result, action_parameters_result, action_full_label, "")

            });
        });
    }
    
    function action_delete_action(input_id){
        
        action_full_label = document.getElementById(input_id+"_action_full_label").value
        $.getJSON($SCRIPT_ROOT + '/_delete_action', {
            action_full_label   : action_full_label
        }, function(data) {
            
            main_row = document.getElementById(input_id + "_main_row")
            main_row.parentNode.removeChild(main_row)
        });
    }
    
    function is_valid_action(){
        
        return_value = true
        
        // Action label
        
        if(document.getElementById("action_action_label").value == ""){
            if(return_value){
                alert("Missing action label")
                return_value = false
            }
        }
        
        // Parameters
        has_active_agent = false
        alert_text = ""
        parameter_count = document.getElementById("action_parameter_count_selector").value
        for(var i=1;i<=parameter_count;i++){
            // Check if blank
            if(document.getElementById("action_parameter"+i+"_parameter_label").value.trim() == ""){
                if(return_value){
                    alert_text = alert_text + "\nMissing parameter label for parameter " + i
                    return_value = false
                }
            }
            // Check character constraints
            
            
            // Check type
            if(document.getElementById("action_parameter"+i+"_parameter_type").value.trim() == ""){
                if(return_value){
                    alert_text = alert_text + "\nMissing parameter type for parameter " + i
                    return_value = false
                }
            }
            
            // Check active agents
            if(document.getElementById("action_parameter"+1+"_is_agent").checked){
                has_active_agent = true
            }
        }
        
        if(!return_value){
            alert(alert_text)
        }
        
        /*
        return_value = has_active_agent
        if(!has_active_agent){
            alert("Actions need at least one active agent")
        }
        */
        
        
        // Preconditions
        
        //for(){
        //    predicate_"+target+"_"+predicate_predicate_order+"_predicate_raw
        //}
        
        // Effects
        
        var _found_flag = false
        
        for(i=1;i<10;i++){
            try{
                someid = document.getElementById("predicate_effect_"+i+"_id").value
                _found_flag = true
                break
            }catch(err){
            }
        }
        if(!_found_flag){
            alert("At least one effect is required")
            return_value = false
        }
        

        
        // Human Readable Strings
        //  - Minimum of one
        
        found_flag = false
        for(var i=0;i<_MAX_ACTION_HUMANREADABLES ;i++){
            tempstring = document.getElementById("action_humanreadable_string_"+(i+1)+"_input").value.trim()
            if(tempstring != ""){
                found_flag = true
                if(return_value){
                    return_value = humanreadable_verify('action',(i+1)+"",6)
                    if(!return_value){
                        alert("HR - invalid")
                        return_value = false
                    }
                }
            }else{

                
            }
        }
        if(!found_flag){
            if(return_value){
                alert("HR - no found")
                return_value = false
            }
        }
        
        return return_value
    }
    
    function action_add_onclick(){
        // Finalize stuff?
        action_action_label = document.getElementById("action_action_label").value
        action_full_label = "{{ domain_instance.domain_full_label }}" + "_" + action_action_label
        
        if(is_valid_action()){
            status = "VERIFIED"
        }else{
            status = "INCOMPLETE"
        }
        
        for(var i=1;i<=_MAX_ACTION_PARAMETERS;i++){
            if(i <= document.getElementById("action_parameter_count_selector").value){
                //ENABLE
                //document.getElementById("action_parameter"+i+"_main_row").classList.remove("collapse")
                add_action_parameter(i)
            }else{
                //DISABLE
                //document.getElementById("action_parameter"+i+"_main_row").classList.add("collapse")
                delete_action_parameter(i)
            }
        }
        
        //alert(document.getElementById("action_edit").checked)
        if(!document.getElementById("action_edit").checked){
            output_HTML = document.getElementById("action_existing_actions_display_area").innerHTML + "\n"
            
            output_HTML = output_HTML + "<div class='row pt-1' id='action_"+action_action_label+"_main_row'>\n"
            output_HTML = output_HTML + "    <div class='col-sm-5'>\n"
            output_HTML = output_HTML + "        "+action_action_label+"\n"
            output_HTML = output_HTML + "        <input class='form-control'  type='hidden' disabled id='action_"+action_action_label+"_action_label' value='"+action_action_label+"'/>\n"
            output_HTML = output_HTML + "        <input class='form-control'  type='hidden' disabled id='action_"+action_action_label+"_action_full_label' value='"+action_full_label+"'/>\n"
            output_HTML = output_HTML + "    </div>\n"
            output_HTML = output_HTML + "    <div class='col-sm-3' id='action_"+action_action_label+"_status_display'>\n"
            
            if(status == "VERIFIED"){
                output_HTML = output_HTML + "        <button class='btn btn-success btn-sm' disabled>Verified</button>\n"
            }
            
            if(status == "INCOMPLETE"){
                output_HTML = output_HTML + "        <button class='btn btn-warning btn-sm' disabled>Incomplete</button>\n"
            }
            
            output_HTML = output_HTML + "    </div>\n"
            output_HTML = output_HTML + "    <div class='col-sm-4'>\n"
            output_HTML = output_HTML + "        <button id='action_edit_"+action_action_label+"_edit_button' \n"
            output_HTML = output_HTML + "                type='button' \n"
            output_HTML = output_HTML + "                class='btn btn-info btn-sm' \n"
            output_HTML = output_HTML + "                onclick='action_edit_action_onclick(\"action_"+action_action_label+"\")'"
            output_HTML = output_HTML + "        >\n"
            output_HTML = output_HTML + "            Edit Action\n"
            output_HTML = output_HTML + "        </button>\n"
            
            output_HTML = output_HTML + "        <button id='action_edit_"+action_action_label+"_delete_button' \n"
            output_HTML = output_HTML + "                type='button' \n"
            output_HTML = output_HTML + "                class='btn btn-info btn-sm' \n"
            output_HTML = output_HTML + "                onclick='confirm_action_delete(\"action_"+action_action_label+"\")'"
            output_HTML = output_HTML + "                "
            output_HTML = output_HTML + "        >\n"
            output_HTML = output_HTML + "            Delete Action\n"
            output_HTML = output_HTML + "        </button>\n"
            output_HTML = output_HTML + "    </div>\n"
            output_HTML = output_HTML + "</div>\n"
            
            document.getElementById("action_existing_actions_display_area").innerHTML = output_HTML
        }
        
        agents = []
        
        for(paramctr=1;paramctr<=_MAX_ACTION_PARAMETERS;paramctr++){
        
            if(document.getElementById("action_parameter"+paramctr+"_is_agent").checked){
                agent_label = document.getElementById("action_parameter"+paramctr+"_parameter_label").value
                agent_type  = document.getElementById("action_parameter"+paramctr+"_parameter_type").value
                agents.push([agent_label, agent_type])
                
            }
        }
        
        humanreadable_string1 = document.getElementById("action_humanreadable_string_1_input").value
        humanreadable_string2 = document.getElementById("action_humanreadable_string_2_input").value
        humanreadable_string3 = document.getElementById("action_humanreadable_string_3_input").value
        humanreadable_string4 = document.getElementById("action_humanreadable_string_4_input").value
        
        
        try{
            agents1_label = agents[0][0]
            agents1_type  = agents[0][1]       
        }catch(err){
            agents1_label = ""
            agents1_type = ""
        }
        try{
            agents2_label = agents[1][0]
            agents2_type  = agents[1][1]       
        }catch(err){
            agents2_label = ""
            agents2_type = ""
        }
        try{
            agents3_label = agents[2][0]
            agents3_type  = agents[2][1]       
        }catch(err){
            agents3_label = ""
            agents3_type = ""
        }
        try{
            agents4_label = agents[3][0]
            agents4_type  = agents[3][1]       
        }catch(err){
            agents4_label = ""
            agents4_type = ""
        }
        
        $.getJSON($SCRIPT_ROOT + '/_update_action_status', {
            
            action_full_label       : action_full_label         ,
            status                  : status                    ,
            function_str            : action_getFunctionString(),
            agents1_label           : agents1_label             ,
            agents1_type            : agents1_type              ,
            agents2_label           : agents2_label             ,
            agents2_type            : agents2_type              ,
            agents3_label           : agents3_label             ,
            agents3_type            : agents3_type              ,
            agents4_label           : agents4_label             ,
            agents4_type            : agents4_type              ,
            humanreadable_string1   : humanreadable_string1     ,
            humanreadable_string2   : humanreadable_string2     ,
            humanreadable_string3   : humanreadable_string3     ,
            humanreadable_string4   : humanreadable_string4
            
        }, function(data) {
            //window.location.href = '/domain_instance/#actions_section';
            //window.location.reload(true)
        });

    }
    
    function action_getFunctionString(){
        
        var output_str = ""
        
        if(document.getElementById("action_action_label").value != ""){
            raw_label = document.getElementById("action_action_label").value;
            // TODO: need to make legal:  ^\w+$
            raw_label = raw_label.replace(" ","_");
            
            output_str += raw_label + "("
        }
        
        for(var i=1;i<=_MAX_ACTION_PARAMETERS;i++){
            if(document.getElementById("action_parameter"+i+"_parameter_label").value != ""){
                raw_label = document.getElementById("action_parameter"+i+"_parameter_label").value;
                param_type = document.getElementById("action_parameter"+i+"_parameter_type").value;
                // TODO: need to make legal:  ^\w+$
                raw_label = raw_label.replace(" ","_");
                
                if(i>1){
                    output_str += ",?" + raw_label
                }else{
                    output_str += "?" + raw_label
                }
            }
        }
        output_str += ")"
        
        return(output_str)

    }
    
    function confirm_action_delete(input_id){
    
        action_label = document.getElementById(input_id + "_action_label").value
        document.getElementById("confirm_action_delete_input_id").value = input_id
        document.getElementById("confirm_action_delete_submodal_body").innerHTML = "Are you sure you want to delete '"+action_label+"'?"
    }
    
</script>

<!-- //==== -->
<div class="content-section" id="actions_section">
    <div class="row form-group">
        <div class="col-md-8">
            <h3 class="display-5">Actions</h3>
            <div class="small text-info font-italic">
            <!--*Tooltip area thingie -->
            </div>
        </div>
        <div class="col-md-2">
            <!-- Trigger the modal with a button -->
            <!--
            <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#action_editmodal">Add Action</button>
            -->

            <!-- Trigger the modal with a button -->
            {% if (user_id == domain_instance.created_by) or ("WRITE" in domain_instance.visibility) %}
            <button type="button" 
                    class="btn btn-info btn-sm" 
                    data-toggle="modal" 
                    data-target="#action_action_label_modal" 
                    onclick="action_input_reset()">
                Add Action
            </button>
            {% endif %}
        </div>
    </div>
    
    <!-- INITIAL Action Name Dialog -->
        <div class="modal fade" id="action_action_label_modal" role="dialog">
            <div class="modal-dialog">
            
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  
                  <h4 class="modal-title">Action Name</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                
                  <p class="small text-info font-italic"><!--Some text in the modal. --></p>
                  
                  <div class="row form-group">
                      <div class="col-md-4">
                      Action Label
                          <div class="small text-info font-italic">
                          *Alphanumeric and underscore characters allowed; no spaces
                          </div>
                      </div>
                      <div class="col-md-5">
                          <input class='form-control'  id="action_action_label_input" type="text" size="16" onchange="action_action_label_input_onchange()">
                      </div>
                  </div>
                  
                  <div class="row form-group pt-1">
                    <div class="col-md-4">
                    Copy from
                    </div>
                    <div class="col-md-5">
                    
                        <select class="form-control" id="action_action_copyfrom">
                            <option value="" selected>--None--</option>
                        {% for someactiondef in action_defs %}
                            <option value="{{ someactiondef.action_label }}">{{ someactiondef.action_label }}</option>
                        {% endfor %}
                        </select>
                    </div>
                  </div>
                
                </div>
                <div class="modal-footer">
                  <button id="action_define_action_label_button"    type="button" class="btn btn-default border-info" data-dismiss="modal" onclick="action_define_action_label()">Define</button>
                  <button id="statepredicate_cancel" type="button" class="btn btn-default border-info" data-dismiss="modal">Cancel</button>
                  
                </div>
              </div>
        
            </div>
        </div>
    <!-- [END] Initial Action name dialog -->
    
    <!-- Edit Space-->
    <div class="row form-group">
        <div class="col-md-12">
            <div class="content-section collapse border-3 border-warning" id="action_editmodal">
                <div class="modal-header">
                  
                  <h4 class="modal-title">Action Definition</h4>
                  <a href="#action_editmodal" data-toggle="collapse" aria-expanded="false" class="close" id="action_input_modal_close">&times;</a>
                  
                </div>
                <div class="modal-body">
                
                    <p class="small text-info font-italic"><!--Some text in the modal. --></p>
                    <div class="row form-group">
                        <div class="col-md-12" id="action_humanreadable_input_flash_area">
                          <div class="alert alert-info">
                            Note: Alphanumeric and underscore characters allowed; no spaces
                          </div>
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-md-3">
                        Action Label
                            <div class="small text-info font-italic">
                            
                            </div>
                            <div class="small text-info font-italic collapse">
                            Edit: 
                            <input class="" type="checkbox" id="action_edit" disabled>  
                            </div>
                        </div>
                        <div class="col-md-5">
                            <input class='form-control'  id="action_id" disabled type="hidden" size="16">
                            <input class='form-control'  id="action_action_label" disabled type="text" size="16">
                        </div>
                    </div>
                    
                    <!-- PARAMETERS -->
                    <hr>
                    <div class="row form-group">
                        <div class="col-md-3">
                        Parameters
                        </div>
                        <div class="col-md-3">
                          <select class='form-control'  id="action_parameter_count_selector" onchange="action_parameter_count_selector_onchange()" length="4">
                            <option value="1" selected>1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                          </select>
                        </div>
                        
                        <div class="col-md-6">
                            <div id="action_editmodal_function_string_preview" class="small">
                            
                            </div>
                        </div>
                    </div>
                    <div class="row pt=1">
                        <div class="col-md-3">
                        </div>
                        <div class="col-md-8">
                            <div class="row pt=1 text-info">
                                <div class="col-md-4">
                                Label
                                </div>
                                <div class="col-md-4">
                                Type
                                </div>
                                <div class="col-md-3">
                                Active Agent
                                </div>
                            </div>

                        
                        </div>
                    </div>
                    <div id="action_parameters_display_area">
                    </div>
                    
                    <script>
                      create_action_parameters_display_area(6,1);
                    </script>
                    
                    <!-- PRECONDITIONS -->
                    <hr>
                    <div class="row form-group">
                        <div class="col-md-3">
                        Preconditions
                        </div>
                        <div class="col-md-8">
                            <!-- Done -->
                            <div class="row pt-1">
                                <div class="col-sm-6">
                                <button type="button" 
                                        class="btn btn-info btn-sm" 
                                        data-toggle="modal" 
                                        data-target="#addpredicate_submodal"
                                        id="action_add_precondition_predicate_add">
                                        <!--onclick="action_add_predicate_label_onchange()">-->
                                    Add State Predicate
                                </button>
                                </div>
                            </div>
                            <div class="row pt-1">
                                <div class="col-sm-6">
                                <button type="button" 
                                        class="btn btn-info btn-sm" 
                                        data-toggle="modal" 
                                        data-target="#equality_condition_submodal"
                                        onclick="update_action_add_equality_parameters_display_area()">
                                    Add Equality Conditional
                                </button>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <!-- [start of existing preconditions -->
                    
                    <div id="action_precondition_display_area" class="row">
                      <div class="col-sm-8">
                        <table class="table table-striped" id="action_precondition_display_area_table">
                          <tbody id="action_precondition_display_area_tbody">
                          </tbody>
                        </table>
                      </div>
                    </div>
                    
                    <!-- [end of existing preconditions -->
                    
                    <!-- EFFECTS -->
                    <hr>
                    <div class="row form-group">
                        <div class="col-md-12" id="action_humanreadable_input_flash_area">
                          <div class="alert alert-info">
                            Note: At least one effect is required
                          </div>
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-md-3">
                        Effects
                        <!--<p class="small text-danger font-italic">*At least one effect is required</p>-->
                        </div>
                        <div class="col-md-8">
                            <div class="row pt-1">
                                <div class="col-sm-6">
                                <button type="button" 
                                        class="btn btn-info btn-sm" 
                                        data-toggle="modal" 
                                        data-target="#addpredicate_submodal"
                                        id="action_add_effect_predicate_add"
                                        <!--onclick="action_add_predicate_label_onchange()-->">
                                    Add State Predicate
                                </button>
                                </div>
                            </div>
                            <div class="row pt-1">
                                <div class="col-sm-6">
                                <button type="button" 
                                        class="btn btn-info btn-sm" 
                                        data-toggle="modal" 
                                        data-target="#addintention_submodal"
                                        id="action_add_effect_intention_add"
                                        onclick="update_action_add_intention_predicate_update_intention_actor('intention_predicate')"
                                >
                                    Add Intention Predicate
                                </button>
                                </div>
                            </div>
                            <div class="row pt-1">
                                <div class="col-sm-6">
                                <button type="button" 
                                        class="btn btn-info btn-sm" 
                                        data-toggle="modal" 
                                        data-target="#whenthen_condition_submodal">
                                        Add When-Then Conditional
                                </button>
                                </div>
                            </div>
                            <div class="row pt-1">
                                <div class="col-sm-6">
                                
                                <button type="button" 
                                        class="btn btn-info btn-sm"
                                        data-toggle="modal" 
                                        data-target="#forall_condition_submodal"
                                        >
                                        Add For-All Conditional
                                </button>
                                
                                </div>
                            </div>

                            
                        </div>
                    </div>
                    
                    <!-- [start of existing effects -->
                    <div id="action_effect_display_area" class="row">
                      <div class="col-sm-8">
                        <table class="table table-striped" id="action_effect_display_area_table">
                          <tbody id="action_effect_display_area_tbody">
                          </tbody>
                        </table>
                      </div>
                    </div>
                    <!-- [end of existing effects -->
                    
                    <hr>
                    <div class="row form-group">
                        <div class="col-md-12" id="action_humanreadable_input_flash_area">
                          <div class="alert alert-info">
                            Note: An action needs at least ONE human readable string
                          </div>
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-md-3">
                        Human Readable Strings
                        </div>
                        <div class="col-md-6">
                            <textarea class='form-control'  id="action_humanreadable_string_1_input" rows="3" cols="30" onchange="humanreadable_verify('action','1',6)"></textarea> <br>
                            <textarea class='form-control'  id="action_humanreadable_string_2_input" rows="3" cols="30" onchange="humanreadable_verify('action','2',6)"></textarea> <br>
                            <textarea class='form-control'  id="action_humanreadable_string_3_input" rows="3" cols="30" onchange="humanreadable_verify('action','3',6)"></textarea> <br>
                            <textarea class='form-control'  id="action_humanreadable_string_4_input" rows="3" cols="30" onchange="humanreadable_verify('action','4',6)"></textarea> <br>

                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                <!--
                  <button type="button" class="btn btn-default border-info" data-dismiss="modal">Add</button>
                  <button type="button" class="btn btn-default border-info" data-dismiss="modal">Cancel</button>
                -->  
                  <a href="#action_editmodal" data-toggle="collapse" aria-expanded="false" class="navbar-toggle btn btn-success" onclick="action_add_onclick()">Verify and Add Action</a>
                  
                </div>
            </div>
        </div>
    </div>
        
    <!-- [END] Edit space -->
    
    <!-- Existing actions -->
    <div id="action_existing_actions_display_area">
        
        {% for someactiondef in action_defs %}
        <div class="row pt-1 div-hover" id="action_{{ someactiondef.action_label }}_main_row">
            <div class="col-sm-5">
                {{ someactiondef.action_label }}
                
                <input class='form-control'  type="hidden" disabled id="action_{{ someactiondef.action_label }}_action_label" value="{{ someactiondef.action_label }}"/>
                <input class='form-control'  type="hidden" disabled id="action_{{ someactiondef.action_label }}_action_full_label" value="{{ someactiondef.action_full_label }}"/>
            </div>
            <div class="col-sm-3" id="action_{{ someactiondef.action_label }}_status_display">
                {% if someactiondef.status == "VERIFIED" %}
                
                <button class="btn btn-success btn-sm" disabled>Verified</button>
                {% endif %}
                {% if someactiondef.status == "INCOMPLETE" %}
                
                <button class="btn btn-warning btn-sm" disabled>Incomplete</button>
                {% endif %}
            </div>
            <div class="col-sm-4">
                {% if (user_id == domain_instance.created_by) or ("WRITE" in domain_instance.visibility) %}
                <button id="action_edit_{{ someactiondef.action_label }}_edit_button" 
                        type="button" 
                        class="btn btn-info btn-sm" 
                        onclick="action_edit_action_onclick('action_{{ someactiondef.action_label }}')">
                    Edit Action
                </button>
                
                <button id="action_edit_{{ someactiondef.action_label }}_delete_button" 
                        type="button" 
                        class="btn btn-info btn-sm" 
                        data-toggle="modal" 
                        data-target="#confirm_action_delete_submodal"
                        onclick="confirm_action_delete('action_{{ someactiondef.action_label }}')"
                >
                    Delete Action
                </button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    
    </div>

    <!--
    return 'action: ' + self.name + \
    '\n  parameters: ' + str(self.parameters) + \
    '\n  preconditions: ' + str(self.preconditions) + \
    '\n     pos:' + str(self.positive_preconditions) + \
    '\n     neg:' + str(self.negative_preconditions) + \
    '\n  effects: ' + str(self.effects) + \
    '\n     pos:' + str(self.possible_positive_effects) + \
    '\n     neg:' + str(self.possible_negative_effects) + \
    '\n  agents: ' + str(self.agents) + \
    '\n  cost: ' + str(self.cost) + '\n'
    -->
        


</div>

<!-- =============================================================== -->

<!----------- [ FINALIZE ] -->
<div class="content-section" id="finalize_section">

    <div class="row form-group">
        <div class="col-md-8">
            <h3 class="display-5">
            Finalize Domain
            <img class="loader-img" id="img_finalize_loader" src="{{ url_for('static', filename='assets/loader2.gif') }}" style="visibility: hidden;">
            </h3>
            
            <div class="small text-info font-italic">
            <!--*Tooltip area thingie -->
            </div>
        </div>
    </div>
    <div class="row form-group">
        <div class="col-md-8">
            <button type="button" 
                    id="generate_domain_file_button"
                    class="btn btn-info btn-sm alert-success" 
                    onclick="generate_domain_file()">
                Generate Domain File
            </button>
            
            <button type="button" 
                    class="btn btn-info btn-sm alert-success" 
                    onclick="evaluate_domain()">
                Evaluate Domain
            </button>
            
        </div>
    </div>
</div>

<!-- =============================================================== -->
<!-- [Submodals: Add When-Then Conditional] -->
<div class="modal fade" id="whenthen_condition_submodal" role="dialog">
    <script>
        function action_add_whenthen_add_submit_onclick(){ 
            //===================
            target = "effect"
            
            
            
            //===============================================================
            // WHEN-CONDITION
            //  1.
            final_output = "['when', ['and', ["
            
            first_flag = true
            for(somectr=1;somectr<=_MAX_STATEPREDICATE_PARAMETERS;somectr++){            
            
                predicate_label = document.getElementById("action_add_whenthen_cond"+somectr+"_predicate_label").value
                if(predicate_label == ""){
                
                }else{
                
                    if(first_flag){
                        whenthen_cond_def_str = ""
                        first_flag = false
                    }else{
                        whenthen_cond_def_str = ", "
                    }
                    
                    if(document.getElementById("action_add_whenthen_cond"+somectr+"_not").checked){
                        whenthen_cond_def_str = whenthen_cond_def_str + "['not', ["
                    }else{
                        whenthen_cond_def_str = whenthen_cond_def_str + "["
                    }
                    
                    //  2.
                    whenthen_cond_pred_label = predicate_label
                    whenthen_cond_pred_body = ""
                    
                    //  3.
                    for(var i=1;i<=_MAX_ACTION_PARAMETERS;i++){
                        try{
                            raw_parameter = document.getElementById("action_whenthen_cond"+somectr+"_parameter"+i).value
                            split_str = raw_parameter.replace(/[()]/g, '').split(' - ')
                            whenthen_cond_pred_body = whenthen_cond_pred_body + ", ['" + split_str[0] + "', '" + split_str[1] + "']"
                        }catch(err){
                        
                        }
                    }
                    
                    //  4.
                    if(document.getElementById("action_add_whenthen_cond"+somectr+"_not").checked){
                        whenthen_cond_def_str = whenthen_cond_def_str + "'" + whenthen_cond_pred_label + "'" + whenthen_cond_pred_body + "]]"
                    }else{
                        whenthen_cond_def_str = whenthen_cond_def_str + "'" + whenthen_cond_pred_label + "'" + whenthen_cond_pred_body + "]"
                    }
                    
                    //  5.
                    //alert(whenthen_cond_def_str)
                    final_output = final_output + whenthen_cond_def_str
                }
            }
            
            //===============================================================
            // WHEN-EFFECT
            //  1.
            final_output = final_output + "]], 'then', ['and', ["
            
            first_flag = true
            for(somectr=1;somectr<=_MAX_STATEPREDICATE_PARAMETERS;somectr++){
                
                predicate_label = document.getElementById("action_add_whenthen_effect"+somectr+"_predicate_label").value
                if(predicate_label == ""){
                
                }else{
            
                    if(first_flag){
                        whenthen_effect_def_str = ""
                        first_flag = false
                    }else{
                        whenthen_effect_def_str = ", "
                    }
                    
                    if(document.getElementById("action_add_whenthen_effect"+somectr+"_not").checked){
                        whenthen_effect_def_str = whenthen_effect_def_str + "['not', ["
                    }else{
                        whenthen_effect_def_str = whenthen_effect_def_str + "["
                    }
                    
                    //  2.
                    whenthen_effect_pred_label = predicate_label
                    whenthen_effect_pred_body = ""
                    
                    //  3.
                    for(var i=1;i<=_MAX_ACTION_PARAMETERS;i++){
                        
                        try{
                            raw_parameter = document.getElementById("action_whenthen_effect"+somectr+"_parameter"+i).value
                                                                     
                            split_str = raw_parameter.replace(/[()]/g, '').split(' - ')
                            whenthen_effect_pred_body = whenthen_effect_pred_body + ", ['" + split_str[0] + "', '" + split_str[1] + "']"
                        }catch(err){
                        
                        }
                    }
                    
                    
                    //  4.
                    if(document.getElementById("action_add_whenthen_effect"+somectr+"_not").checked){
                        whenthen_effect_def_str = whenthen_effect_def_str + "'" + whenthen_effect_pred_label + "'" + whenthen_effect_pred_body + "]]"
                    }else{
                        whenthen_effect_def_str = whenthen_effect_def_str + "'" + whenthen_effect_pred_label + "'" + whenthen_effect_pred_body + "]"
                    }
                    

                    final_output = final_output + whenthen_effect_def_str
                    
                }
            }
            
            final_output = final_output + "]]]"
            //alert(final_output)
            
            //===============================================================
            // ===>
            action_label = document.getElementById("action_action_label").value
            action_full_label = "{{ domain_instance.domain_full_label }}" + "_" + action_label
            if(target == "precondition"){
                type = type + "PRECON"
            }else{
                type = "SOME_EFFECT"
            }
            // ===>
            $.getJSON($SCRIPT_ROOT + '/_add_action_predicate', {
                
                action_full_label   : action_full_label ,
                type                : type   ,
                predicate_raw       : final_output
                
            }, function(data) {
                update_action_display_area(target, data.result)
            });
        }
        
    </script>
    <div class="modal-dialog" style="max-width: 600px;">
    
      <!-- Modal content-->
      <div class="modal-content" style="background-color: #f0f0f0;">
        <div class="modal-header">
          <h4 class="modal-title">Add When-Then Conditional</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
        
            <p class="small text-info font-italic">Tooltip area thingie</p>
            
            <div class="row form-group">
                <div class="col-md-12">
                    <!--/////////////////////////////////////// [WHEN] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                            WHEN
                        </div>
                    </div>
                    
                    <!--/////////////////////////////////////// [WHEN CONDITION 1] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_whenthen_cond1_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div>
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_whenthen_cond1_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_whenthen_cond1_definition_str" onchange="action_add_predicate_label_onchange('whenthen_cond1', false);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_whenthen_cond1_parameters_display_area">
                            </div>
                        </div>
                    </div>                    
                    <!--/////////////////////////////////////// [WHEN CONDITION 2] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_whenthen_cond2_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div>
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_whenthen_cond2_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_whenthen_cond2_definition_str" onchange="action_add_predicate_label_onchange('whenthen_cond2', false);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_whenthen_cond2_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    <!--/////////////////////////////////////// [WHEN CONDITION 3] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_whenthen_cond3_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div>
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_whenthen_cond3_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_whenthen_cond3_definition_str" onchange="action_add_predicate_label_onchange('whenthen_cond3', false);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_whenthen_cond3_parameters_display_area">
                            </div>
                        </div>
                    </div>                    
                    <!--/////////////////////////////////////// [WHEN CONDITION 4] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_whenthen_cond4_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div>
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_whenthen_cond4_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_whenthen_cond4_definition_str" onchange="action_add_predicate_label_onchange('whenthen_cond4', false);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_whenthen_cond4_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    

                    
                    <!--/////////////////////////////////////// [THEN] -->
                    <div class="row pt-1">
                        <div class="col-sm-2">
                            THEN
                        </div>
                    </div>
                    
                    <!--/////////////////////////////////////// [THEN EFFECT 1] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_whenthen_effect1_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div> 
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_whenthen_effect1_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_whenthen_effect1_definition_str" onchange="action_add_predicate_label_onchange('whenthen_effect1', false);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_whenthen_effect1_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    
                    
                    <!--/////////////////////////////////////// [THEN EFFECT 2] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_whenthen_effect2_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div> 
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_whenthen_effect2_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_whenthen_effect2_definition_str" onchange="action_add_predicate_label_onchange('whenthen_effect2', false);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_whenthen_effect2_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    
                    <!--/////////////////////////////////////// [THEN EFFECT 3] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_whenthen_effect3_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div> 
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_whenthen_effect3_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_whenthen_effect3_definition_str" onchange="action_add_predicate_label_onchange('whenthen_effect3', false);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_whenthen_effect3_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    
                    <!--/////////////////////////////////////// [THEN EFFECT 4] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_whenthen_effect4_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div> 
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_whenthen_effect4_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_whenthen_effect4_definition_str" onchange="action_add_predicate_label_onchange('whenthen_effect4', false);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_whenthen_effect4_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    
                    
                    
                </div>
            </div>
        
        
        </div>
        <div class="modal-footer">
          <button type="button" 
            class="btn btn-default border-info" 
            data-dismiss="modal"
            onclick="action_add_whenthen_add_submit_onclick()">
            Add
          </button>
          <button type="button" class="btn btn-default border-info" data-dismiss="modal">Cancel</button>
        </div>
      </div>
      
    </div>
</div>

<!-- [Submodals: Add For-All Conditional] -->
<div class="modal fade" id="forall_condition_submodal" role="dialog">
    <script>
        function action_add_forall_add_submit_onclick(){ 
            //===================
            target = "effect"
            
            //===============================================================
            // FORALL-VAR
            final_output = "['forall', ["
            
            forall_var_label = document.getElementById("action_add_forall_var_label").value
            forall_var_type = document.getElementById("action_add_forall_var_type").value
            final_output = final_output + "'!" + forall_var_label + "', '"+forall_var_type+"'], "
            
            final_output = final_output + "'when', ['and', ["
            //===============================================================
            // WHEN-CONDITION
            //  1.
            first_flag = true
            for(somectr=1;somectr<=_MAX_STATEPREDICATE_PARAMETERS;somectr++){            
            
                predicate_label = document.getElementById("action_add_forall_whenthen_cond"+somectr+"_predicate_label").value
                if(predicate_label == ""){
                
                }else{
                
                    if(first_flag){
                        whenthen_cond_def_str = ""
                        first_flag = false
                    }else{
                        whenthen_cond_def_str = ", "
                    }
                    
                    if(document.getElementById("action_add_forall_whenthen_cond"+somectr+"_not").checked){
                        whenthen_cond_def_str = whenthen_cond_def_str + "['not', ["
                    }else{
                        whenthen_cond_def_str = whenthen_cond_def_str + "["
                    }
                    
                    //  2.
                    whenthen_cond_pred_label = predicate_label
                    whenthen_cond_pred_body = ""
                    
                    //  3.
                    for(var i=1;i<=_MAX_ACTION_PARAMETERS;i++){
                        try{
                            raw_parameter = document.getElementById("action_forall_whenthen_cond"+somectr+"_parameter"+i).value
                            split_str = raw_parameter.replace(/[()]/g, '').split(' - ')
                            whenthen_cond_pred_body = whenthen_cond_pred_body + ", ['" + split_str[0] + "', '" + split_str[1] + "']"
                        }catch(err){
                        
                        }
                    }
                    
                    //  4.
                    if(document.getElementById("action_add_forall_whenthen_cond"+somectr+"_not").checked){
                        whenthen_cond_def_str = whenthen_cond_def_str + "'" + whenthen_cond_pred_label + "'" + whenthen_cond_pred_body + "]]"
                    }else{
                        whenthen_cond_def_str = whenthen_cond_def_str + "'" + whenthen_cond_pred_label + "'" + whenthen_cond_pred_body + "]"
                    }
                    
                    //  5.
                    //alert(whenthen_cond_def_str)
                    final_output = final_output + whenthen_cond_def_str
                }
            }
            
            
            //===============================================================
            // WHEN-EFFECT
            //  1.
            final_output = final_output + "]], 'then', ['and', ["
            
            first_flag = true
            for(somectr=1;somectr<=_MAX_STATEPREDICATE_PARAMETERS;somectr++){
                
                predicate_label = document.getElementById("action_add_forall_whenthen_effect"+somectr+"_predicate_label").value
                if(predicate_label == ""){
                
                }else{
            
                    if(first_flag){
                        whenthen_effect_def_str = ""
                        first_flag = false
                    }else{
                        whenthen_effect_def_str = ", "
                    }
                    
                    if(document.getElementById("action_add_forall_whenthen_effect"+somectr+"_not").checked){
                        whenthen_effect_def_str = whenthen_effect_def_str + "['not', ["
                    }else{
                        whenthen_effect_def_str = whenthen_effect_def_str + "["
                    }
                    
                    //  2.
                    whenthen_effect_pred_label = predicate_label
                    whenthen_effect_pred_body = ""
                    
                    //  3.
                    for(var i=1;i<=_MAX_ACTION_PARAMETERS;i++){
                        
                        try{
                            raw_parameter = document.getElementById("action_forall_whenthen_effect"+somectr+"_parameter"+i).value
                                                                     
                            split_str = raw_parameter.replace(/[()]/g, '').split(' - ')
                            whenthen_effect_pred_body = whenthen_effect_pred_body + ", ['" + split_str[0] + "', '" + split_str[1] + "']"
                        }catch(err){
                        
                        }
                    }
                    
                    
                    //  4.
                    if(document.getElementById("action_add_forall_whenthen_effect"+somectr+"_not").checked){
                        whenthen_effect_def_str = whenthen_effect_def_str + "'" + whenthen_effect_pred_label + "'" + whenthen_effect_pred_body + "]]"
                    }else{
                        whenthen_effect_def_str = whenthen_effect_def_str + "'" + whenthen_effect_pred_label + "'" + whenthen_effect_pred_body + "]"
                    }
                    

                    final_output = final_output + whenthen_effect_def_str
                    
                }
            }
            
            final_output = final_output + "]]]"
            //alert(final_output)
            
            //===============================================================
            // ===>
            action_label = document.getElementById("action_action_label").value
            action_full_label = "{{ domain_instance.domain_full_label }}" + "_" + action_label
            if(target == "precondition"){
                type = type + "PRECON"
            }else{
                type = "SOME_EFFECT"
            }
            // ===>
            $.getJSON($SCRIPT_ROOT + '/_add_action_predicate', {
                
                action_full_label   : action_full_label ,
                type                : type   ,
                predicate_raw       : final_output
                
            }, function(data) {
                update_action_display_area(target, data.result)
            });
        }
        
        function action_add_forall_var_label_onchange(){
            forall_var = document.getElementById("action_add_forall_var_label").value
            
            if(forall_var != ""){
                for(somectr=1;somectr<=_MAX_STATEPREDICATE_PARAMETERS;somectr++){
                    document.getElementById("action_add_forall_whenthen_cond"+somectr+"_not").disabled = false
                    document.getElementById("action_add_forall_whenthen_cond"+somectr+"_definition_str").disabled = false
                    document.getElementById("action_add_forall_whenthen_effect"+somectr+"_definition_str").disabled = false
                }
            }else{
                for(somectr=1;somectr<=_MAX_STATEPREDICATE_PARAMETERS;somectr++){
                    document.getElementById("action_add_forall_whenthen_cond"+somectr+"_not").disabled = true
                    document.getElementById("action_add_forall_whenthen_cond"+somectr+"_definition_str").disabled = true
                    document.getElementById("action_add_forall_whenthen_effect"+somectr+"_definition_str").disabled = true
                }
            }
        }
        
        
    </script>
    <div class="modal-dialog" style="max-width: 600px;">
    
      <!-- Modal content-->
      <div class="modal-content" style="background-color: #f0f0f0;">
        <div class="modal-header">
          <h4 class="modal-title">Add For-All Conditional</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
        
            <p class="small text-info font-italic">Tooltip area thingie</p>
            
            <div class="row form-group">
                <div class="col-md-12">
                
                    <!--/////////////////////////////////////// [FOR ALL] -->
                    <div class="row pt-1">
                        <div class="col-sm-4">
                            FOR ALL
                        </div>
                    </div>
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-5">
                            <input class='form-control small'  id="action_add_forall_var_label" type="text" onchange="action_add_forall_var_label_onchange()">
                        </div>
                        <div class="col-sm-5">
                            <select class='form-control' id="action_add_forall_var_type">
                            {% for sometype in object_types %}
                              <option value="{{ sometype.object_type }}">{{ sometype.object_type }}</option>
                            {% endfor %}
                            </select>
                        
                        </div>
                    </div>
                        
                    <!--/////////////////////////////////////// [WHEN] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                            WHEN
                        </div>
                    </div>
                    
                    <!--/////////////////////////////////////// [WHEN CONDITION 1] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_forall_whenthen_cond1_not" type="checkbox" disabled> <span class="font-italic muted text-info">not</span>
                        </div>
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_forall_whenthen_cond1_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_forall_whenthen_cond1_definition_str" onchange="action_add_predicate_label_onchange('forall_whenthen_cond1', true);" disabled>
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_forall_whenthen_cond1_parameters_display_area">
                            </div>
                        </div>
                    </div>                    
                    <!--/////////////////////////////////////// [WHEN CONDITION 2] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_forall_whenthen_cond2_not" type="checkbox" disabled> <span class="font-italic muted text-info">not</span>
                        </div>
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_forall_whenthen_cond2_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_forall_whenthen_cond2_definition_str" onchange="action_add_predicate_label_onchange('forall_whenthen_cond2', true);" disabled>
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_forall_whenthen_cond2_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    <!--/////////////////////////////////////// [WHEN CONDITION 3] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_forall_whenthen_cond3_not" type="checkbox" disabled> <span class="font-italic muted text-info">not</span>
                        </div>
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_forall_whenthen_cond3_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_forall_whenthen_cond3_definition_str" onchange="action_add_predicate_label_onchange('forall_whenthen_cond3', true);" disabled>
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_forall_whenthen_cond3_parameters_display_area">
                            </div>
                        </div>
                    </div>                    
                    <!--/////////////////////////////////////// [WHEN CONDITION 4] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_forall_whenthen_cond4_not" type="checkbox" disabled> <span class="font-italic muted text-info">not</span>
                        </div>
                        <div class="col-sm-6">
                            <input class='form-control small'  id="action_add_forall_whenthen_cond4_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_forall_whenthen_cond4_definition_str" onchange="action_add_predicate_label_onchange('forall_whenthen_cond4', true);" disabled>
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-6">
                            <div id="action_add_forall_whenthen_cond4_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    <!--/////////////////////////////////////// [THEN] -->
                    <div class="row pt-1">
                        <div class="col-sm-2">
                            THEN
                        </div>
                    </div>
                    <!--/////////////////////////////////////// [THEN EFFECT 1] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_forall_whenthen_effect1_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div> 
                        <div class="col-sm-6">
                            <span class="" id="">
                              
                            <input class='form-control small'  id="action_add_forall_whenthen_effect1_predicate_label" type="hidden">
                            <select class='form-control' id="action_add_forall_whenthen_effect1_definition_str" onchange="action_add_predicate_label_onchange('forall_whenthen_effect1', true);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                            
                            
                            </span>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-8">
                            <div id="action_add_forall_whenthen_effect1_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    <!--/////////////////////////////////////// [THEN EFFECT 2] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_forall_whenthen_effect2_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div> 
                        <div class="col-sm-6">
                            <span class="" id="">
                              
                            <input class='form-control small'  id="action_add_forall_whenthen_effect2_predicate_label" type="hidden">
                            <select class='form-control' id="action_add_forall_whenthen_effect2_definition_str" onchange="action_add_predicate_label_onchange('forall_whenthen_effect2', true);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                            
                            
                            </span>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-8">
                            <div id="action_add_forall_whenthen_effect2_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    <!--/////////////////////////////////////// [THEN EFFECT 3] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_forall_whenthen_effect3_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div> 
                        <div class="col-sm-6">
                            <span class="" id="">
                              
                            <input class='form-control small'  id="action_add_forall_whenthen_effect3_predicate_label" type="hidden">
                            <select class='form-control' id="action_add_forall_whenthen_effect3_definition_str" onchange="action_add_predicate_label_onchange('forall_whenthen_effect3', true);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                            
                            
                            </span>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-8">
                            <div id="action_add_forall_whenthen_effect3_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    <!--/////////////////////////////////////// [THEN EFFECT 4] -->
                    <div class="row pt-1">
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-2">
                            <input class="form-check-input" id="action_add_forall_whenthen_effect4_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div> 
                        <div class="col-sm-6">
                            <span class="" id="">
                              
                            <input class='form-control small'  id="action_add_forall_whenthen_effect4_predicate_label" type="hidden">
                            <select class='form-control' id="action_add_forall_whenthen_effect4_definition_str" onchange="action_add_predicate_label_onchange('forall_whenthen_effect4', true);">
                              <option value="">--Select one--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                            
                            
                            </span>
                        </div>
                    </div>
                    
                    <div class="row pt-1">
                        <div class="col-sm-3">
                        </div>
                        <div class="col-sm-8">
                            <div id="action_add_forall_whenthen_effect4_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    
                    
                    
                    
                </div>
            </div>
        
        
        </div>
        <div class="modal-footer">
          <button type="button" 
            class="btn btn-default border-info" 
            data-dismiss="modal"
            onclick="action_add_forall_add_submit_onclick()">
            Add
          </button>
          <button type="button" class="btn btn-default border-info" data-dismiss="modal">Cancel</button>
        </div>
      </div>
      
    </div>
</div>


<!-- [Submodals: Equality] -->
<div class="modal fade" id="equality_condition_submodal" role="dialog">
    <script>
    
    function update_action_add_equality_parameters_display_area(){
        
        output_HTML = ""
        // Operand 1
        output_HTML = output_HTML + "                        <select class='form-control'  id='action_equality_parameter1'>\n"
        for(j=0;j<document.getElementById("action_parameter_count_selector").value;j++){
            parameter_label = document.getElementById("action_parameter"+(j+1)+"_parameter_label").value
            parameter_type  = document.getElementById("action_parameter"+(j+1)+"_parameter_type").value
            output_HTML = output_HTML + "                        <option value='(?"+parameter_label+" - "+parameter_type+")'>"+parameter_label+"</option>\n"
        }
        output_HTML = output_HTML + "                        </select>\n"
        output_HTML = output_HTML + "                        = \n"
        
        // Operand 2
        output_HTML = output_HTML + "                        <select class='form-control'  id='action_equality_parameter2'>\n"
        for(j=0;j<document.getElementById("action_parameter_count_selector").value;j++){
            parameter_label = document.getElementById("action_parameter"+(j+1)+"_parameter_label").value
            parameter_type  = document.getElementById("action_parameter"+(j+1)+"_parameter_type").value
            output_HTML = output_HTML + "                        <option value='(?"+parameter_label+" - "+parameter_type+")'>"+parameter_label+"</option>\n"
        }
        output_HTML = output_HTML + "                        </select>\n"
        
        document.getElementById("action_add_equality_parameters_display_area").innerHTML = output_HTML
    }
    
    function action_add_equality_add_submit_onclick(){
        //===================
        target = "precondition"

        if(document.getElementById("action_add_equality_not").checked){
            action_def_str = "['not', ['equals'"
            type = "NEG_"
        }else{
            action_def_str = "['equals'"
            type = "POS_"
        }
        
        // Operand 1
        raw_parameter = document.getElementById("action_equality_parameter1").value
        split_str = raw_parameter.replace(/[()]/g, '').split(' - ')
        action_def_str = action_def_str + ", ['" + split_str[0] + "', '" + split_str[1] + "']"
        // Operand 2
        raw_parameter = document.getElementById("action_equality_parameter2").value
        split_str = raw_parameter.replace(/[()]/g, '').split(' - ')
        action_def_str = action_def_str + ", ['" + split_str[0] + "', '" + split_str[1] + "']"

        if(document.getElementById("action_add_equality_not").checked){
            action_def_str = action_def_str + "]]"
        }else{
            action_def_str = action_def_str + "]"
        }
        
        action_label = document.getElementById("action_action_label").value
        action_full_label = "{{ domain_instance.domain_full_label }}" + "_" + action_label
        
        type = type + "PRECON"
            
        //===================
        $.getJSON($SCRIPT_ROOT + '/_add_action_predicate', {
            
            action_full_label   : action_full_label ,
            type                : type   ,
            predicate_raw       : action_def_str
            
        }, function(data) {
            update_action_display_area(target, data.result)
        });
    }
    
    </script>
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content" style="background-color: #f0f0f0;">
        <div class="modal-header">
          <h4 class="modal-title">Add Equality Condition</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
        
            <p class="small text-info font-italic">Tooltip area thingie</p>
          
            <div class="row form-group">
                <div class="col-md-12">
                    <input class="form-check-input"  id="action_add_equality_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                    <span class="" id="action_add_equality_parameters_display_area">
                    </span>  
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default border-info" data-dismiss="modal" onclick="action_add_equality_add_submit_onclick()">Add</button>
          <button type="button" class="btn btn-default border-info" data-dismiss="modal">Cancel</button>
        </div>
      </div>
      
    </div>
</div>

<!-- [Submodals: Add Predicate] -->
<div class="modal fade" id="addpredicate_submodal" role="dialog">
    <script>
        function update_action_add_predicate_parameters_display_area(raw_result, target, include_forall_var){
            
            output_HTML = ""
            
            raw_rows = raw_result.split("/|")
            
            for(var i=0; i<raw_rows.length; i++){
                split_row = raw_rows[i].split("/;")
                //alert(split_row.length)
                if(split_row.length == 44){
                    document.getElementById("action_add_"+target+"_predicate_label").value = split_row[2]
                    //alert(split_row[2])
                    for(p=0; p<_MAX_ACTION_PARAMETERS; p++){
                        p_i = 4+(p*4)
                        if(split_row[p_i] != ""){
                            //alert(split_row[p_i] + ":" + split_row[p_i+1])
                            output_HTML = output_HTML + "            <div class='row'>\n"
                            output_HTML = output_HTML + "                <div class='col-sm-2'>\n"
                            output_HTML = output_HTML + "                </div>\n"
                            output_HTML = output_HTML + "                <div class='col-sm-8'>\n"
                            output_HTML = output_HTML + "                    <span>\n"
                            output_HTML = output_HTML + "                        <select class='form-control'  id='action_"+target+"_parameter"+(p+1)+"'>\n"
                            
                            if(include_forall_var){
                                parameter_label = document.getElementById("action_add_forall_var_label").value
                                parameter_type = document.getElementById("action_add_forall_var_type").value
                                
                                //if((typeIsOfType(parameter_type, split_row[p_i+1])) || (typeIsOfType(split_row[p_i+1],parameter_type))){
                                if(typeIsOfType(parameter_type, split_row[p_i+1])){
                                    output_HTML = output_HTML + "                        <option value='(!"+parameter_label+" - "+parameter_type+")'>!" + parameter_label+"</option>\n"
                                }
                            }
                            
                            for(j=0;j<document.getElementById("action_parameter_count_selector").value;j++){
                                //alert(temp_parameters[1] + " == " + split_row[p_i+1])
                                
                                parameter_label = document.getElementById("action_parameter"+(j+1)+"_parameter_label").value
                                parameter_type  = document.getElementById("action_parameter"+(j+1)+"_parameter_type").value
                                
                                //if((typeIsOfType(parameter_type, split_row[p_i+1])) || (typeIsOfType(split_row[p_i+1],parameter_type))){
                                if(typeIsOfType(parameter_type, split_row[p_i+1])){
                                    output_HTML = output_HTML + "                        <option value='(?"+parameter_label+" - "+parameter_type+")'>"+parameter_label+"</option>\n"
                                }
                            }
                            

                            
                            output_HTML = output_HTML + "                        </select>\n"
                            output_HTML = output_HTML + "                    </span>\n"
                            output_HTML = output_HTML + "                </div>\n"
                            output_HTML = output_HTML + "            </div>\n"
                        }
                    }

                    //document.getElementById("action_add_predicate_parameters_display_area").innerHTML = output_HTML
                    document.getElementById("action_add_"+target+"_parameters_display_area").innerHTML = output_HTML
                }
            }
        }
        
        function action_add_predicate_label_onchange(target, include_forall_var){
            //alert("??? + " + document.getElementById("action_add_"+target+"_definition_str").value)
            
            definition_str = document.getElementById("action_add_"+target+"_definition_str").value
            
            if(definition_str != ""){
                $.getJSON($SCRIPT_ROOT + '/_get_state_predicate_def_info', {
                    
                    domain_id      :  "{{ domain_instance.id }}",
                    definition_str :  definition_str
                    
                }, function(data) {
                    update_action_add_predicate_parameters_display_area(data.result, target, include_forall_var)
                });
            }else{
                document.getElementById("action_add_"+target+"_predicate_label").value = ""
                document.getElementById("action_add_"+target+"_parameters_display_area").innerHTML = ""
            }
            
        }
        
        function update_action_display_area(target,raw_result){
            //  Parse
            
            raw_rows = raw_result.split("/|")
            for(var i=0; i<raw_rows.length; i++){
                split_row = raw_rows[i].split("/;")
                
                if(split_row.length == 9){
                    predicate_id                        = split_row[0]
                    predicate_action_full_label         = split_row[1]
                    predicate_type                      = split_row[2]
                    predicate_predicate_def_id          = split_row[3]
                    predicate_predicate_instance_id     = split_row[4]
                    predicate_predicate_raw             = split_row[5]
                    predicate_predicate_function_str    = split_row[6]
                    predicate_predicate_order           = split_row[7]
                    
                    //  if ID exists, update that row
                    
                    //  else, create new row
                    
                    tbody = document.getElementById("action_"+target+"_display_area_tbody")
                    
                    //tbody.innerHTML = ""
                    
                    row = document.createElement("tr")
                    row.id = "action_predicate_"+predicate_id+"_main_row"
                    row.classList.add("text-break")
                    row.classList.add("small")
                    
                    //      Cell 1
                    cell = document.createElement("td")
                    output_HTML = ""
                    output_HTML = output_HTML + "                <input class='form-control'  id='predicate_"+target+"_"+predicate_predicate_order+"_id'                type='hidden' class='small' value='"+predicate_id               +"'>\n"
                    output_HTML = output_HTML + "                <input class='form-control'  id='predicate_"+target+"_"+predicate_predicate_order+"_action_full_label' type='hidden' class='small' value='"+predicate_action_full_label+"'>\n"
                    output_HTML = output_HTML + "                <input class='form-control'  id='predicate_"+target+"_"+predicate_predicate_order+"_predicate_raw'   type='hidden' class='small' value='"+predicate_predicate_raw  +"'>\n"
                    output_HTML = output_HTML + "                <input class='form-control'  id='predicate_"+target+"_"+predicate_predicate_order+"_predicate_order'   type='hidden' class='small' value='"+predicate_predicate_order  +"'>\n"
                    cell.innerHTML = output_HTML
                    row.appendChild(cell);
                    
                    //      Cell 2
                    cell = document.createElement("td")
                    output_HTML = ""
                    output_HTML = output_HTML + "                    " + predicate_predicate_raw + "<br>\n"
                    cell.innerHTML = output_HTML
                    row.appendChild(cell);
                    
                    //      Cell 3
                    cell = document.createElement("td")
                    output_HTML = ""
                    output_HTML = output_HTML + "                   <button class=\"btn btn-small alert-dark\" onclick=\"action_delete_predicate('"+target+"','"+predicate_id+"')\"'>\n"
                    //output_HTML = output_HTML + "                       <i class='material-icons'>clear</i>\n"
                    output_HTML = output_HTML + "                   &times;</button>\n"
                    cell.innerHTML = output_HTML
                    row.appendChild(cell);
                    
                    tbody.appendChild(row)
                    
                    /*
                    output_HTML = document.getElementById("action_"+target+"_display_area").innerHTML
                    
                    output_HTML = output_HTML + "            <div id='action_predicate_"+predicate_id+"_main_row' class='row'>\n"
                    output_HTML = output_HTML + "                <div class='col-md-3'>\n"
                    output_HTML = output_HTML + "                \n"
                    output_HTML = output_HTML + "                <input class='form-control'  id='predicate_"+target+"_"+predicate_predicate_order+"_id'                type='hidden' class='small' value='"+predicate_id               +"'>\n"
                    output_HTML = output_HTML + "                <input class='form-control'  id='predicate_"+target+"_"+predicate_predicate_order+"_action_full_label' type='hidden' class='small' value='"+predicate_action_full_label+"'>\n"
                    output_HTML = output_HTML + "                <input class='form-control'  id='predicate_"+target+"_"+predicate_predicate_order+"_predicate_order'   type='hidden' class='small' value='"+predicate_predicate_order  +"'>\n"
                    output_HTML = output_HTML + "                </div>\n"
                    output_HTML = output_HTML + "                <div class='col-md-6 small'>\n"
                    output_HTML = output_HTML + "                    " + predicate_predicate_raw + " | potato stuff<br>\n"
                    output_HTML = output_HTML + "                </div>\n"
                    output_HTML = output_HTML + "                <div class='col-md-2 small'>\n"
                    output_HTML = output_HTML + "                   <button class=\"btn btn-small alert-dark\" onclick=\"action_delete_predicate('"+target+"','"+predicate_id+"')\"'>\n"
                    //output_HTML = output_HTML + "                       <i class='material-icons'>clear</i>\n"
                    output_HTML = output_HTML + "                   &times;</button>\n"
                    output_HTML = output_HTML + "                </div>\n"
                    output_HTML = output_HTML + "            </div>\n"
                    
                    document.getElementById("action_"+target+"_display_area").innerHTML = output_HTML
                    */
                }
            }
                
            document.getElementById("action_"+target+"_display_area").classList.remove("collapse")
        }
        
        function action_delete_predicate(target, predicate_id){
        
            main_row = document.getElementById("action_predicate_"+predicate_id+"_main_row");
            main_row.parentNode.removeChild(main_row)
            
            $.getJSON($SCRIPT_ROOT + '/_delete_action_predicate', {
                
                predicate_id   : predicate_id
                
            }, function(data) {
                
            });
            
        }
        
        function action_add_predicate_add_submit_onclick(){ 
            //===================
            target = document.getElementById("action_add_predicate_target").value

            if(document.getElementById("action_add_predicate_not").checked){
                action_def_str = "['not', ["
                type = "NEG_"
            }else{
                action_def_str = "["
                type = "POS_"
            }
            
            action_def_pred_label = document.getElementById("action_add_predicate_predicate_label").value
            action_def_pred_body = ""
            
            for(var i=1;i<_MAX_ACTION_PARAMETERS;i++){
                try{
                    raw_parameter = document.getElementById("action_predicate_parameter"+i).value
                    split_str = raw_parameter.replace(/[()]/g, '').split(' - ')
                    action_def_pred_body = action_def_pred_body + ", ['" + split_str[0] + "', '" + split_str[1] + "']"
                }catch(err){
                
                }
            }
            
            if(document.getElementById("action_add_predicate_not").checked){
                action_def_str = action_def_str + "'" + action_def_pred_label + "'" + action_def_pred_body + "]]"
            }else{
                action_def_str = action_def_str + "'" + action_def_pred_label + "'" + action_def_pred_body + "]"
            }
            
            action_label = document.getElementById("action_action_label").value
            action_full_label = "{{ domain_instance.domain_full_label }}" + "_" + action_label
            
            if(target == "precondition"){
                type = type + "PRECON"
            }else{
                type = "SOME_EFFECT"
            }
            
            //===================
            $.getJSON($SCRIPT_ROOT + '/_add_action_predicate', {
                
                action_full_label   : action_full_label ,
                type                : type   ,
                predicate_raw       : action_def_str
                
            }, function(data) {
                update_action_display_area(target, data.result)
            });
        }
        
    </script>
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content" style="background-color: #f0f0f0;">
        <div class="modal-header">
          <h4 class="modal-title">Add State Predicate</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
        
            <p class="small text-info font-italic">Tooltip area thingie</p>
            <!-- Hidden data stuff -->
            <input class='form-control small'  id="action_add_predicate_target" type="hidden" disabled>
          
            <div class="row form-group">
                <div class="col-md-12">
                    <div class="row">
                        
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-3">
                            <input class="form-check-input" id="action_add_predicate_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div>
                        <div class="col-sm-8">
                            <span class="" id="">
                              
                            <input class='form-control small'  id="action_add_predicate_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_predicate_definition_str" onchange="action_add_predicate_label_onchange('predicate', false);">
                              <option value="">--Select one..--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                            
                            </span>                                    
                        </div>
                    </div>

                    <div class="row pt-1">
                        <div class="col-sm-2">
                        </div>
                        <div class="col-sm-2">
                        </div>
                        
                        <div class="col-sm-8">
                            <div id="action_add_predicate_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-info" data-dismiss="modal" onclick="action_add_predicate_add_submit_onclick()">Add</button>
          <button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
        </div>
      </div>
      
    </div>
</div>

<!-- [Submodals: Add Intention] -->
<div class="modal fade" id="addintention_submodal" role="dialog">
    <script>
        function update_action_add_intention_predicate_update_intention_actor(target){
            
            output_HTML = ""
            
            output_HTML = output_HTML + "            <div class='row'>\n"
            output_HTML = output_HTML + "                <div class='col-sm-12'>\n"
            output_HTML = output_HTML + "                    <span>\n"
            output_HTML = output_HTML + "                        <select class='form-control'  id='action_"+target+"_intention_actor'>\n"
            for(j=0;j<document.getElementById("action_parameter_count_selector").value;j++){
                //alert(temp_parameters[1] + " == " + split_row[p_i+1])
                
                parameter_label = document.getElementById("action_parameter"+(j+1)+"_parameter_label").value
                parameter_type  = document.getElementById("action_parameter"+(j+1)+"_parameter_type").value
                
                //if((typeIsOfType(parameter_type, split_row[p_i+1])) || (typeIsOfType(split_row[p_i+1],parameter_type))){
                if(typeIsOfType(parameter_type, 'actor')){
                    output_HTML = output_HTML + "                        <option value='(?"+parameter_label+" - "+parameter_type+")'>"+parameter_label+"</option>\n"
                }
            }
            output_HTML = output_HTML + "                        </select>\n"
            output_HTML = output_HTML + "                    </span>\n"
            output_HTML = output_HTML + "                </div>\n"
            output_HTML = output_HTML + "            </div>\n"
                            
            document.getElementById("action_add_"+target+"_intention_actor_display_area").innerHTML = output_HTML
        }
    
        function update_action_add_intention_predicate_parameters_display_area(raw_result, target, include_forall_var){
            
            output_HTML = ""
            
            raw_rows = raw_result.split("/|")
            
            for(var i=0; i<raw_rows.length; i++){
                split_row = raw_rows[i].split("/;")
                //alert(split_row.length)
                if(split_row.length == 44){
                    
                    document.getElementById("action_add_"+target+"_predicate_label").value = split_row[2]
                    //alert(split_row[2])
                    for(p=0; p<_MAX_ACTION_PARAMETERS; p++){
                        p_i = 4+(p*4)
                        if(split_row[p_i] != ""){
                            //alert(split_row[p_i] + ":" + split_row[p_i+1])
                            output_HTML = output_HTML + "            <div class='row'>\n"
                            output_HTML = output_HTML + "                <div class='col-sm-2'>\n"
                            output_HTML = output_HTML + "                </div>\n"
                            output_HTML = output_HTML + "                <div class='col-sm-8'>\n"
                            output_HTML = output_HTML + "                    <span>\n"
                            output_HTML = output_HTML + "                        <select class='form-control'  id='action_"+target+"_parameter"+(p+1)+"'>\n"
                            
                            if(include_forall_var){
                                parameter_label = document.getElementById("action_add_forall_var_label").value
                                parameter_type = document.getElementById("action_add_forall_var_type").value
                                
                                //if((typeIsOfType(parameter_type, split_row[p_i+1])) || (typeIsOfType(split_row[p_i+1],parameter_type))){
                                if(typeIsOfType(parameter_type, split_row[p_i+1])){
                                    output_HTML = output_HTML + "                        <option value='(!"+parameter_label+" - "+parameter_type+")'>!" + parameter_label+"</option>\n"
                                }
                            }
                            
                            for(j=0;j<document.getElementById("action_parameter_count_selector").value;j++){
                                //alert(temp_parameters[1] + " == " + split_row[p_i+1])
                                
                                parameter_label = document.getElementById("action_parameter"+(j+1)+"_parameter_label").value
                                parameter_type  = document.getElementById("action_parameter"+(j+1)+"_parameter_type").value
                                
                                //if((typeIsOfType(parameter_type, split_row[p_i+1])) || (typeIsOfType(split_row[p_i+1],parameter_type))){
                                if(typeIsOfType(parameter_type, split_row[p_i+1])){
                                    output_HTML = output_HTML + "                        <option value='(?"+parameter_label+" - "+parameter_type+")'>"+parameter_label+"</option>\n"
                                }
                            }
                            

                            
                            output_HTML = output_HTML + "                        </select>\n"
                            output_HTML = output_HTML + "                    </span>\n"
                            output_HTML = output_HTML + "                </div>\n"
                            output_HTML = output_HTML + "            </div>\n"
                        }
                    }

                    //document.getElementById("action_add_predicate_parameters_display_area").innerHTML = output_HTML
                    document.getElementById("action_add_"+target+"_parameters_display_area").innerHTML = output_HTML
                }
            }
        }
        
        function action_add_intention_predicate_label_onchange(target, include_forall_var){
            //alert("??? + " + document.getElementById("action_add_"+target+"_definition_str").value)
            
            definition_str = document.getElementById("action_add_"+target+"_definition_str").value
            
            if(definition_str != ""){
                $.getJSON($SCRIPT_ROOT + '/_get_state_predicate_def_info', {
                    
                    domain_id      :  "{{ domain_instance.id }}",
                    definition_str :  definition_str
                    
                }, function(data) {
                    update_action_add_intention_predicate_parameters_display_area(data.result, target, include_forall_var)
                });
            }else{
                document.getElementById("action_add_"+target+"_predicate_label").value = ""
                document.getElementById("action_add_"+target+"_parameters_display_area").innerHTML = ""
            }
            
        }
        
        function action_add_intention_predicate_add_submit_onclick(){ 
            //===================
            target = document.getElementById("action_add_intention_predicate_target").value

            if(document.getElementById("action_add_intention_predicate_actor_not").checked){
                action_def_str = "['not', ["
                type = "NEG_"
            }else{
                action_def_str = "["
                type = "POS_"
            }
            
            /*
            if(document.getElementById("action_add_intention_predicate_predicate_not").checked){
                action_def_str = "['not', ["
                type = "NEG_"
            }else{
                action_def_str = "["
                type = "POS_"
            }
            */
            
            action_def_pred_label = document.getElementById("action_add_intention_predicate_predicate_label").value
            action_def_pred_body = ""
            
            for(var i=1;i<_MAX_ACTION_PARAMETERS;i++){
                try{
                    raw_parameter = document.getElementById("action_intention_predicate_parameter"+i).value
                    split_str = raw_parameter.replace(/[()]/g, '').split(' - ')
                    action_def_pred_body = action_def_pred_body + ", ['" + split_str[0] + "', '" + split_str[1] + "']"
                }catch(err){
                
                }
            }
            
            
            if(document.getElementById("action_add_intention_predicate_predicate_not").checked){
                action_def_pred_complete = "[['not', ['" + action_def_pred_label + "'" + action_def_pred_body + "]], 'predicate']"
            }else{
                
                action_def_pred_complete = "[['" + action_def_pred_label + "'" + action_def_pred_body + "], 'predicate']"
            }
            
            
            
            action_def_pred_actor = ""
            try{
                raw_actor = document.getElementById("action_intention_predicate_intention_actor").value
                split_str = raw_actor.replace(/[()]/g, '').split(' - ')
                action_def_pred_actor = action_def_pred_actor + "['" + split_str[0] + "', '" + split_str[1] + "']"
            }catch(err){
            
            }
            
            
            if(document.getElementById("action_add_intention_predicate_actor_not").checked){
                action_def_str = action_def_str + "'intends', " + action_def_pred_actor + ", " + action_def_pred_complete + "]]"
            }else{
                action_def_str = action_def_str + "'intends', " + action_def_pred_actor + ", " + action_def_pred_complete + "]"
            }
            
            action_label = document.getElementById("action_action_label").value
            action_full_label = "{{ domain_instance.domain_full_label }}" + "_" + action_label
            
            if(target == "precondition"){
                type = type + "PRECON"
            }else{
                type = "SOME_EFFECT"
            }
            
            
            //alert(action_def_str)
            
            //===================
            $.getJSON($SCRIPT_ROOT + '/_add_action_predicate', {
                
                action_full_label   : action_full_label ,
                type                : type   ,
                predicate_raw       : action_def_str
                
            }, function(data) {
                update_action_display_area(target, data.result)
            });
            
        }
        
    </script>
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content" style="background-color: #f0f0f0;">
        <div class="modal-header">
          <h4 class="modal-title">Add Intention Predicate</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
        
            <p class="small text-info font-italic"></p>
            <!-- Hidden data stuff -->
            <input class='form-control small'  id="action_add_intention_predicate_target" type="hidden" disabled> <!-- if precondition or effect -->
          
            <div class="row form-group">
                <div class="col-md-12">

                    <!-- Intention actor-->
                    <div class="row">
                        <div class="col-sm-12">
                        <p class="small text-info font-italic">Intention Actor</p>
                        </div>
                    </div>
                    <div class="row">
                        
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-3">
                            <input class="form-check-input" id="action_add_intention_predicate_actor_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div>
                        <div class="col-sm-8">
                            <div id="action_add_intention_predicate_intention_actor_display_area">
                            </div>
                        </div>
                    </div>

                    
                    <!-- Intention target predicate-->
                    <div class="row">
                        <div class="col-sm-12">
                        <p class="small text-info font-italic">Intention target predicate</p>
                        </div>
                    </div>
                    <div class="row">
                        
                        <div class="col-sm-1">
                        </div>
                        <div class="col-sm-3">
                            <input class="form-check-input" id="action_add_intention_predicate_predicate_not" type="checkbox"> <span class="font-italic muted text-info">not</span>
                        </div>
                        <div class="col-sm-8">
                            <span class="" id="">
                              
                            <input class='form-control small'  id="action_add_intention_predicate_predicate_label" disabled type="hidden">
                            <select class='form-control' id="action_add_intention_predicate_definition_str" onchange="action_add_intention_predicate_label_onchange('intention_predicate', false);">
                              <option value="">--Select one..--</option>
                            {% for somepred in state_predicate_defs %}
                              <option value="{{ somepred.definition_str }}">{{ somepred.predicate_label }}</option>
                            {% endfor %}
                            </select>
                            
                            </span>                                    
                        </div>
                    </div>

                    <div class="row pt-1">
                        <div class="col-sm-2">
                        </div>
                        <div class="col-sm-2">
                        </div>
                        
                        <div class="col-sm-8">
                            <div id="action_add_intention_predicate_parameters_display_area">
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-info" data-dismiss="modal" onclick="action_add_intention_predicate_add_submit_onclick()">Add</button>
          <button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
        </div>
      </div>
      
    </div>
</div>

<!-- [Submodals: Confirm Delete Action] -->
<div class="modal fade" id="confirm_action_delete_submodal" role="dialog">

    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header" style="border-bottom: 0px;">
        
          <!--<h4 class="modal-title">Confirm Action Delete</h4>-->
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <!--
        <div class="modal-body">
            
        </div>
        -->
        
        <div class="modal-body" id="confirm_action_delete_submodal_body" style="border-bottom: 0px;">
        </div>
        
        <div class="modal-footer" style="border-top: 0px;">
          <input type="hidden" id="confirm_action_delete_input_id">
          <button type="button" class="btn btn-danger" data-dismiss="modal" onclick="action_delete_action(document.getElementById('confirm_action_delete_input_id').value)">Confirm Delete</button>
          <button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
</div>
<!----------- [ BOTTOM MENU BAR ] -->
<!--
<div class="content-section">
    <div class="btn-group">
        <button type="button" class="btn btn-info btn-sm">New</button>
        <button type="button" class="btn btn-info btn-sm">Save</button> 
        <button type="button" class="btn btn-info btn-sm">Load</button>
    </div>
</div>
-->

{% endblock content %}